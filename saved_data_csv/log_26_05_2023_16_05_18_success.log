2023-05-25 16:14:43,665 [INFO    ] Скрипт запущен: 2023-05-25 16:14:43.665796
2023-05-25 16:14:43,725 [INFO    ] Connected (version 2.0, client OpenSSH_7.4p1)
2023-05-25 16:14:43,803 [INFO    ] Authentication (publickey) failed.
2023-05-25 16:14:43,827 [INFO    ] Connected (version 2.0, client OpenSSH_7.4p1)
2023-05-25 16:14:43,916 [INFO    ] Authentication (password) successful!
2023-05-25 16:14:43,946 [INFO    ] connected to host 5.188.28.225 base app_nedvizhka_db
2023-05-25 16:14:44,106 [INFO    ] yandex token valid
2023-05-25 16:14:47,261 [INFO    ] Успешно загружено 1 файлов с личного диска: ['циан 17-05-23 (без дублей).csv'] для cian
2023-05-25 16:14:47,262 [INFO    ] ready to process files [], ['циан 17-05-23 (без дублей).csv']
2023-05-25 16:14:47,262 [INFO    ] обработка файла циан 17-05-23 (без дублей).csv для cian
2023-05-25 16:14:48,391 [INFO    ] обработка district_id:
2023-05-25 16:14:48,393 [INFO    ] districts_update:   0%|          | 0/121065 [00:00<?, ?it/s]
2023-05-25 16:15:03,394 [INFO    ] districts_update:  12%|#2        | 14860/121065 [00:15<01:47, 990.64it/s]
2023-05-25 16:15:18,394 [INFO    ] districts_update:  25%|##4       | 29750/121065 [00:30<01:32, 991.82it/s]
2023-05-25 16:15:28,404 [INFO    ] districts_update:  33%|###2      | 39672/121065 [00:40<01:22, 991.82it/s]
2023-05-25 16:15:33,394 [INFO    ] districts_update:  37%|###6      | 44613/121065 [00:45<01:17, 991.38it/s]
2023-05-25 16:15:48,395 [INFO    ] districts_update:  49%|####9     | 59819/121065 [01:00<01:01, 1000.19it/s]
2023-05-25 16:15:58,439 [INFO    ] districts_update:  58%|#####7    | 69846/121065 [01:10<00:51, 1000.19it/s]
2023-05-25 16:16:03,396 [INFO    ] districts_update:  62%|######1   | 74927/121065 [01:15<00:46, 1002.69it/s]
2023-05-25 16:16:18,456 [INFO    ] districts_update:  74%|#######4  | 90033/121065 [01:30<00:30, 1002.69it/s]
2023-05-25 16:16:18,456 [INFO    ] districts_update:  74%|#######4  | 90034/121065 [01:30<00:30, 1002.83it/s]
2023-05-25 16:16:28,460 [INFO    ] districts_update:  83%|########2 | 100095/121065 [01:40<00:20, 1002.83it/s]
2023-05-25 16:16:33,457 [INFO    ] districts_update:  87%|########6 | 105089/121065 [01:45<00:15, 1003.09it/s]
2023-05-25 16:16:48,458 [INFO    ] districts_update:  99%|#########9| 120175/121065 [02:00<00:00, 1003.92it/s]
2023-05-25 16:16:49,391 [INFO    ] districts_update: 100%|##########| 121065/121065 [02:00<00:00, 1000.55it/s]
2023-05-25 16:16:49,392 [INFO    ] district add from realty
2023-05-25 16:16:50,540 [INFO    ] Успешно обработан файл циан 17-05-23 (без дублей).csv для realty
2023-05-25 16:16:50,548 [INFO    ] Выгрузка в таблицу realty обработанного файла из cian: циан 17-05-23 (без дублей).csv
2023-05-25 16:16:50,626 [INFO    ] Временная таблица очищена
2023-05-25 16:16:59,103 [INFO    ] Загрузка новых объявлений в таблицу
2023-05-25 16:16:59,320 [INFO    ] 117165 существующих и 3900 новых объявлений
2023-05-25 16:17:44,928 [INFO    ] обновлена таблица realty
2023-05-25 16:17:52,647 [INFO    ] обновлены районы в таблице realty
2023-05-25 16:17:59,498 [INFO    ] Обновление существующих данных realty завершено
2023-05-25 16:18:11,635 [INFO    ] из новых объявлений удалось найти по адресу 1064, запрос в ddt для 850 по уник. адресу из 2836
2023-05-25 16:18:11,636 [INFO    ] обновление районов для найденных в realty по адресу новых объявлений:
2023-05-25 16:18:11,806 [INFO    ] обнаружено 133 районов для 133 новых объявлений, найденных по адресу из 188
2023-05-25 16:18:11,811 [INFO    ] 129 районов осталось незаполнено
2023-05-25 16:18:11,812 [INFO    ] переход к обновлению оставшихся (не найденных по адресу) 2836 новых объявлений (850 адресов) для cian
2023-05-25 16:18:11,825 [INFO    ] попытка загрузить данные dadata из /var/www/yadisk_loader/saved_data_csv/cian_dadata_request_2023_05_17.csv
2023-05-25 16:18:11,859 [INFO    ] удалось загрузить исторические данные dadata
2023-05-25 16:18:14,865 [INFO    ] количество запросов к dadata составит: 149
2023-05-25 16:18:14,865 [INFO    ] 0%|          | 0/149 [00:00<?, ?it/s]
2023-05-25 16:18:14,911 [INFO    ] 850it [00:00, 18444.13it/s]
2023-05-25 16:18:14,911 [INFO    ] dadata con closed succesfully
2023-05-25 16:18:14,912 [INFO    ] обращение к DDT по 701/850 адресам из cian заняло 0:00:03.100322
2023-05-25 16:18:14,916 [INFO    ] Index(['source_id', 'ad_id', 'city_id', 'district_id', 'type_id', 'addr',
       'square', 'floor', 'house_floors', 'link', 'date', 'status', 'version',
       'offer_from', 'status_new', 'house_fias_id', 'data', 'geo_lat',
       'geo_lon', 'street', 'house', 'qc', 'result', 'qc_geo'],
      dtype='object')
2023-05-25 16:18:14,919 [INFO    ] обращение к DDT выполнено для 1428/2836 новых объявлений, найден fias для 1030
2023-05-25 16:18:23,528 [INFO    ] уникальных троек по h_fias_id, ad_id, d_id, в таблице с районами и houses_jkh_ddt/id: 1428
2023-05-25 16:18:23,528 [INFO    ] выгрузка данных в таблицу realty
2023-05-25 16:18:24,481 [INFO    ] Добавлено районов к объявлениям realty: 1 - было 1966 стало 1967
2023-05-25 16:18:24,481 [INFO    ] Есть несовпадения районов c jkh, обновление районов в jkh для 87 записей
2023-05-25 16:18:27,577 [INFO    ] Временная таблица temp_jkh_houses очищена
2023-05-25 16:18:31,031 [INFO    ] Обновление данных jkh_houses завершено
2023-05-25 16:18:32,581 [INFO    ] все новые объявления добавлены
2023-05-25 16:18:34,131 [INFO    ] Успешно обработан файл циан 17-05-23 (без дублей).csv для prices
2023-05-25 16:18:34,131 [INFO    ] Выгрузка в таблицу prices обработанного файла из cian: циан 17-05-23 (без дублей).csv
2023-05-25 16:18:43,234 [INFO    ] Новые данные загружены по файлам [] из авито и ['циан 17-05-23 (без дублей).csv'] из циана за 0:03:59.568529
2023-05-26 16:01:28,743 [INFO    ] Скрипт запущен: 2023-05-26 16:01:28.743852
2023-05-26 16:01:28,795 [INFO    ] Connected (version 2.0, client OpenSSH_7.4p1)
2023-05-26 16:01:28,910 [INFO    ] Authentication (publickey) failed.
2023-05-26 16:01:28,922 [INFO    ] Connected (version 2.0, client OpenSSH_7.4p1)
2023-05-26 16:01:29,040 [INFO    ] Authentication (password) successful!
2023-05-26 16:01:29,040 [INFO    ] connected to host 5.188.28.225 base app_nedvizhka_db
2023-05-26 16:01:29,189 [INFO    ] yandex token valid
2023-05-26 16:01:31,400 [INFO    ] Успешно загружено 1 файлов с личного диска: ['циан 25-05-23 (без дублей).csv'] для cian
2023-05-26 16:01:31,400 [INFO    ] ready to process files [], ['циан 25-05-23 (без дублей).csv']
2023-05-26 16:01:31,400 [INFO    ] обработка файла циан 25-05-23 (без дублей).csv для cian
2023-05-26 16:01:32,523 [INFO    ] обработка district_id:
2023-05-26 16:01:32,523 [INFO    ] districts_update:   0%|          | 0/118715 [00:00<?, ?it/s]
2023-05-26 16:01:47,525 [INFO    ] districts_update:  13%|#2        | 15268/118715 [00:15<01:41, 1017.80it/s]
2023-05-26 16:01:59,623 [INFO    ] districts_update:  23%|##3       | 27508/118715 [00:27<01:29, 1017.80it/s]
2023-05-26 16:02:02,525 [INFO    ] districts_update:  26%|##5       | 30437/118715 [00:30<01:27, 1013.95it/s]
2023-05-26 16:02:17,525 [INFO    ] districts_update:  39%|###8      | 45743/118715 [00:45<01:11, 1016.88it/s]
2023-05-26 16:02:29,628 [INFO    ] districts_update:  49%|####9     | 58174/118715 [00:57<00:59, 1016.88it/s]
2023-05-26 16:02:32,526 [INFO    ] districts_update:  52%|#####1    | 61189/118715 [01:00<00:56, 1021.94it/s]
2023-05-26 16:02:47,526 [INFO    ] districts_update:  65%|######4   | 76884/118715 [01:15<00:40, 1030.74it/s]
2023-05-26 16:02:59,642 [INFO    ] districts_update:  75%|#######4  | 89031/118715 [01:27<00:28, 1030.74it/s]
2023-05-26 16:03:02,526 [INFO    ] districts_update:  77%|#######7  | 91860/118715 [01:30<00:26, 1019.73it/s]
2023-05-26 16:03:17,528 [INFO    ] districts_update:  90%|########9 | 106836/118715 [01:45<00:11, 1012.72it/s]
2023-05-26 16:03:29,350 [INFO    ] districts_update: 100%|##########| 118715/118715 [01:56<00:00, 1016.17it/s]
2023-05-26 16:03:29,350 [INFO    ] district add from realty
2023-05-26 16:03:32,509 [INFO    ] Успешно обработан файл циан 25-05-23 (без дублей).csv для realty
2023-05-26 16:03:32,525 [INFO    ] Выгрузка в таблицу realty обработанного файла из cian: циан 25-05-23 (без дублей).csv
2023-05-26 16:03:32,619 [INFO    ] Временная таблица очищена
2023-05-26 16:03:45,527 [INFO    ] Загрузка новых объявлений в таблицу
2023-05-26 16:03:45,720 [INFO    ] 104454 существующих и 14261 новых объявлений
2023-05-26 16:04:28,415 [INFO    ] обновлена таблица realty
2023-05-26 16:04:38,783 [INFO    ] обновлены районы в таблице realty
2023-05-26 16:04:41,920 [INFO    ] Обновление существующих данных realty завершено
2023-05-26 16:04:54,275 [INFO    ] из новых объявлений удалось найти по адресу 5965, запрос в ddt для 3205 по уник. адресу из 8296
2023-05-26 16:04:54,275 [INFO    ] обновление районов для найденных в realty по адресу новых объявлений:
2023-05-26 16:04:54,468 [INFO    ] обнаружено 499 районов для 499 новых объявлений, найденных по адресу из 923
2023-05-26 16:04:54,475 [INFO    ] 490 районов осталось незаполнено
2023-05-26 16:04:54,477 [INFO    ] переход к обновлению оставшихся (не найденных по адресу) 8296 новых объявлений (3205 адресов) для cian
2023-05-26 16:04:54,490 [INFO    ] попытка загрузить данные dadata из /var/www/yadisk_loader/saved_data_csv/cian_dadata_request_2023_05_25.csv
2023-05-26 16:04:54,490 [ERROR   ] нет исторических данных /var/www/yadisk_loader/saved_data_csv/cian_dadata_request_2023_05_25.csv - будет создан новый df для запросов к dadata
2023-05-26 16:05:07,505 [ERROR   ] новые объявления не добавлены
2023-05-26 16:05:07,507 [ERROR   ] Traceback (most recent call last):
  File "/var/www/yadisk_loader/main_utils.py", line 391, in load_and_update_realty_db
    df_dadata_houses = dadata_request(df_realty_new, fdate, source)
  File "/var/www/yadisk_loader/dadata_update_utils.py", line 81, in dadata_request
    count_zapros = df_for_count[~df_for_count.addr.isin(exist_ddt_addr)]
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pandas/core/series.py", line 5563, in isin
    result = algorithms.isin(self._values, values)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pandas/core/algorithms.py", line 459, in isin
    raise TypeError(
TypeError: only list-like objects are allowed to be passed to isin(), you passed a [bool]

2023-05-26 16:05:07,631 [ERROR   ] Ошибка: ['error_loading_into_realty']
2023-05-26 16:05:07,631 [ERROR   ] Не удалось добавить данные в таблицу realty. Перезапуск скрипта...
2023-05-26 16:05:17,692 [INFO    ] Connected (version 2.0, client OpenSSH_7.4p1)
2023-05-26 16:05:17,800 [INFO    ] Authentication (publickey) failed.
2023-05-26 16:05:17,813 [INFO    ] Connected (version 2.0, client OpenSSH_7.4p1)
2023-05-26 16:05:17,941 [INFO    ] Authentication (password) successful!
2023-05-26 16:05:17,941 [INFO    ] connected to host 5.188.28.225 base app_nedvizhka_db
2023-05-26 16:05:17,942 [INFO    ] подключение к базе восстановлено
2023-05-26 16:05:18,041 [INFO    ] Новые данные загружены по файлам [] из авито и ['циан 25-05-23 (без дублей).csv'] из циана за 0:03:49.298089
