2024-01-23 15:08:50,785 [INFO    ] Скрипт запущен: 2024-01-23 15:08:50.784953
2024-01-23 15:08:50,852 [INFO    ] Connected (version 2.0, client OpenSSH_7.4p1)
2024-01-23 15:08:51,042 [INFO    ] Authentication (publickey) failed.
2024-01-23 15:08:51,050 [INFO    ] Connected (version 2.0, client OpenSSH_7.4p1)
2024-01-23 15:08:51,119 [INFO    ] Authentication (password) successful!
2024-01-23 15:08:51,310 [INFO    ] connected to host 92.53.64.66 base app_nedvizhka_db
2024-01-23 15:08:51,466 [INFO    ] yandex token valid
2024-01-23 15:08:54,280 [INFO    ] Успешно загружено 1 файлов с личного диска: ['22-01-24 (без дублей).csv'] для avito
2024-01-23 15:08:54,498 [INFO    ] yandex token valid
2024-01-23 15:08:57,031 [INFO    ] Успешно загружено 1 файлов с личного диска: ['циан 22-01-24 (без дублей).csv'] для cian
2024-01-23 15:08:57,031 [INFO    ] ready to process files ['22-01-24 (без дублей).csv'], ['циан 22-01-24 (без дублей).csv']
2024-01-23 15:09:04,339 [INFO    ] обновлен status_new в таблице realty
2024-01-23 15:12:21,823 [INFO    ] обновлен status_new в таблице prices
2024-01-23 15:12:21,824 [INFO    ] обработка файла циан 22-01-24 (без дублей).csv для cian
2024-01-23 15:12:23,191 [INFO    ] обработка district_id:
2024-01-23 15:12:23,203 [INFO    ] districts_update:   0%|          | 0/114847 [00:00<?, ?it/s]
2024-01-23 15:12:38,203 [INFO    ] districts_update:  12%|#2        | 13869/114847 [00:15<01:49, 924.57it/s]
2024-01-23 15:12:53,204 [INFO    ] districts_update:  25%|##4       | 28511/114847 [00:30<01:30, 954.90it/s]
2024-01-23 15:13:03,218 [INFO    ] districts_update:  34%|###4      | 39489/114847 [00:40<01:18, 954.90it/s]
2024-01-23 15:13:08,204 [INFO    ] districts_update:  39%|###8      | 44521/114847 [00:45<01:09, 1006.23it/s]
2024-01-23 15:13:23,226 [INFO    ] districts_update:  51%|#####1    | 59135/114847 [01:00<00:55, 1006.23it/s]
2024-01-23 15:13:23,227 [INFO    ] districts_update:  51%|#####1    | 59136/114847 [01:00<00:56, 993.04it/s]
2024-01-23 15:13:33,233 [INFO    ] districts_update:  60%|######    | 69220/114847 [01:10<00:45, 993.04it/s]
2024-01-23 15:13:38,227 [INFO    ] districts_update:  64%|######4   | 73886/114847 [01:15<00:41, 989.54it/s]
2024-01-23 15:13:53,243 [INFO    ] districts_update:  77%|#######6  | 88075/114847 [01:30<00:27, 989.54it/s]
2024-01-23 15:13:53,243 [INFO    ] districts_update:  77%|#######6  | 88076/114847 [01:30<00:27, 974.38it/s]
2024-01-23 15:14:08,244 [INFO    ] districts_update:  90%|########9 | 103093/114847 [01:45<00:11, 983.11it/s]
2024-01-23 15:14:20,435 [INFO    ] districts_update: 100%|##########| 114847/114847 [01:57<00:00, 979.65it/s]
2024-01-23 15:14:20,436 [INFO    ] 
2024-01-23 15:14:20,444 [INFO    ] district add from realty
2024-01-23 15:14:22,413 [INFO    ] Успешно обработан файл циан 22-01-24 (без дублей).csv для realty
2024-01-23 15:14:22,421 [INFO    ] Выгрузка в таблицу realty обработанного файла из cian: циан 22-01-24 (без дублей).csv
2024-01-23 15:14:22,566 [INFO    ] Временная таблица очищена
2024-01-23 15:14:35,341 [INFO    ] Загрузка новых объявлений в таблицу
2024-01-23 15:14:35,600 [INFO    ] 114847 существующих и 0 новых объявлений
2024-01-23 15:14:35,604 [INFO    ] temp таблица очищена, загружаются данные
2024-01-23 15:15:38,366 [INFO    ] обновлена таблица realty
2024-01-23 15:16:09,544 [INFO    ] обновлены районы в таблице realty
2024-01-23 15:16:17,863 [INFO    ] Обновление существующих данных realty завершено
2024-01-23 15:16:17,877 [ERROR   ] Traceback (most recent call last):
  File "/var/www/yadisk_loader/main_utils.py", line 390, in load_and_update_realty_db
    if len(df_realty_new.city_id.unique()) > 1 else str('('+str(df_realty_new.city_id.unique()[0])+')'),
IndexError: index 0 is out of bounds for axis 0 with size 0

2024-01-23 15:16:17,877 [INFO    ] какая то хуйня 393 main_utils нужен фикс: 
 []
2024-01-23 15:16:17,881 [INFO    ] не удалось найти совпадения по адресу для новых объявлений, переход к запросу в dadata
2024-01-23 15:16:17,907 [INFO    ] загрузка данных dadata из /var/www/yadisk_loader/saved_data_csv/cian_dadata_request.csv
2024-01-23 15:16:18,963 [INFO    ] удалось загрузить исторические данные dadata
2024-01-23 15:16:20,972 [INFO    ] количество запросов к dadata составит: 0
2024-01-23 15:16:20,973 [INFO    ] 0it [00:00, ?it/s]
2024-01-23 15:16:20,973 [INFO    ] 0it [00:00, ?it/s]
2024-01-23 15:16:20,973 [INFO    ] 
2024-01-23 15:16:20,973 [INFO    ] dadata con closed succesfully
2024-01-23 15:16:20,973 [INFO    ] обращение к DDT по 0/0 адресам из cian заняло 0:00:03.092018
2024-01-23 15:16:20,991 [INFO    ] обращение к DDT выполнено для 0/0 новых объявлений, найден fias для 0
2024-01-23 15:17:53,140 [INFO    ] уникальных троек по h_fias_id, ad_id, d_id, в таблице с районами и houses_jkh_ddt/id: 1
2024-01-23 15:17:53,171 [INFO    ] нет новых записей с houses_jkh_ddt/id, добавляю результаты парсинга as is
2024-01-23 15:17:55,055 [INFO    ] Успешно обработан файл циан 22-01-24 (без дублей).csv для prices
2024-01-23 15:17:55,055 [INFO    ] Выгрузка в таблицу prices обработанного файла из cian: циан 22-01-24 (без дублей).csv
2024-01-23 15:18:08,918 [INFO    ] данные cian загружены успешно
2024-01-23 15:18:09,004 [INFO    ] обработка файла 22-01-24 (без дублей).csv для авито
2024-01-23 15:18:55,685 [INFO    ] Успешно обработан файл 22-01-24 (без дублей).csv для realty
2024-01-23 15:18:55,724 [INFO    ] Выгрузка в таблицу realty обработанного файла из авито: 22-01-24 (без дублей).csv
2024-01-23 15:18:55,827 [INFO    ] Временная таблица очищена
2024-01-23 15:19:02,829 [INFO    ] Загрузка новых объявлений в таблицу
2024-01-23 15:19:03,042 [INFO    ] 180780 существующих и 2167 новых объявлений
2024-01-23 15:19:03,088 [INFO    ] temp таблица очищена, загружаются данные
2024-01-23 15:21:03,722 [INFO    ] обновлена таблица realty
2024-01-23 15:21:05,869 [INFO    ] обновлены районы в таблице realty
2024-01-23 15:21:25,957 [INFO    ] Обновление существующих данных realty завершено
2024-01-23 15:22:06,238 [INFO    ] из новых объяв найдено по адресу 1234, запрос в ddt для 718 уник. адресов из 933
2024-01-23 15:22:06,239 [INFO    ] обновление районов для найденных в realty по адресу новых объявлений:
2024-01-23 15:22:06,524 [INFO    ] обнаружено 920 районов для 978 новых объявлений, найденных по адресу из 1234
2024-01-23 15:22:06,535 [INFO    ] 59 районов осталось незаполнено
2024-01-23 15:22:06,536 [INFO    ] переход к обновлению оставшихся (не найденных по адресу) 933 новых объявлений (718 адресов) для avito
2024-01-23 15:22:06,558 [INFO    ] загрузка данных dadata из /var/www/yadisk_loader/saved_data_csv/avito_dadata_request.csv
2024-01-23 15:22:08,244 [INFO    ] удалось загрузить исторические данные dadata
2024-01-23 15:22:10,256 [INFO    ] количество запросов к dadata составит: 718
2024-01-23 15:22:10,262 [INFO    ] 0%|          | 0/39 [00:00<?, ?it/s]
2024-01-23 15:22:13,272 [INFO    ] 718it [00:03, 238.51it/s]
2024-01-23 15:22:13,272 [INFO    ] 
2024-01-23 15:22:13,273 [INFO    ] dadata con closed succesfully
2024-01-23 15:22:13,273 [INFO    ] обращение к DDT по 679/718 адресам из avito заняло 0:00:06.737254
2024-01-23 15:22:13,284 [INFO    ] обращение к DDT выполнено для 859/933 новых объявлений, найден fias для 652
2024-01-23 15:23:13,152 [INFO    ] уникальных троек по h_fias_id, ad_id, d_id, в таблице с районами и houses_jkh_ddt/id: 859
2024-01-23 15:23:13,152 [INFO    ] выгрузка данных в таблицу realty
2024-01-23 15:23:13,445 [INFO    ] Добавлено районов к объявлениям realty: 141 - было 0 стало 141
2024-01-23 15:23:13,445 [INFO    ] Есть несовпадения районов c jkh, обновление районов в jkh для 0 записей
2024-01-23 15:23:16,544 [INFO    ] Временная таблица temp_jkh_houses очищена
2024-01-23 15:51:13,320 [INFO    ] нет новых записей с houses_jkh_ddt/id, добавляю результаты парсинга as is
2024-01-23 15:54:59,183 [INFO    ] Connected (version 2.0, client OpenSSH_7.4p1)
2024-01-23 15:54:59,257 [INFO    ] Authentication (publickey) failed.
2024-01-23 15:54:59,273 [INFO    ] Connected (version 2.0, client OpenSSH_7.4p1)
2024-01-23 15:54:59,369 [INFO    ] Authentication (password) successful!
2024-01-23 15:54:59,371 [INFO    ] connected to host 92.53.64.66 base app_nedvizhka_db
2024-01-23 15:54:59,372 [INFO    ] подключение к базе восстановлено
2024-01-23 15:57:08,677 [INFO    ] Connected (version 2.0, client OpenSSH_7.4p1)
2024-01-23 15:57:08,728 [INFO    ] Authentication (publickey) failed.
2024-01-23 15:57:08,731 [INFO    ] Connected (version 2.0, client OpenSSH_7.4p1)
2024-01-23 15:57:08,790 [INFO    ] Authentication (password) successful!
2024-01-23 15:57:08,791 [INFO    ] connected to host 92.53.64.66 base app_nedvizhka_db
2024-01-23 15:57:08,792 [INFO    ] подключение к базе восстановлено
2024-01-23 15:57:10,781 [INFO    ] Успешно обработан файл 22-01-24 (без дублей).csv для prices
2024-01-23 15:57:10,781 [INFO    ] Выгрузка в таблицу prices обработанного файла из авито: 22-01-24 (без дублей).csv
2024-01-23 15:57:28,535 [INFO    ] данные avito загружены успешно
2024-01-23 15:57:28,956 [INFO    ] Новые данные загружены по файлам ['22-01-24 (без дублей).csv'] из авито и ['циан 22-01-24 (без дублей).csv'] из циана за 0:48:38.171054
2024-01-23 15:57:29,074 [INFO    ] HTTP Request: GET https://dadata.ru/api/v2/profile/balance "HTTP/1.1 200 OK"
2024-01-23 15:57:29,094 [ERROR   ] Traceback (most recent call last):
  File "/var/www/yadisk_loader/report_utils.py", line 148, in report_text
    i[1] = " ".join(i[1].replace(' ', '').replace('(', ' (').split())
IndexError: list index out of range

2024-01-23 15:57:29,449 [INFO    ] отчет отправлен в tg
2024-01-23 15:57:29,595 [INFO    ] сохранение лог-файла
