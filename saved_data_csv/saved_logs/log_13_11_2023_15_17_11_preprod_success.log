2023-11-13 15:01:30,402 [INFO    ] Скрипт запущен: 2023-11-13 15:01:30.401940
2023-11-13 15:01:30,485 [INFO    ] Connected (version 2.0, client OpenSSH_7.4p1)
2023-11-13 15:01:30,546 [INFO    ] Authentication (publickey) failed.
2023-11-13 15:01:30,552 [INFO    ] Connected (version 2.0, client OpenSSH_7.4p1)
2023-11-13 15:01:30,632 [INFO    ] Authentication (password) successful!
2023-11-13 15:01:30,749 [INFO    ] connected to host 92.53.64.66 base preprod_nedvizhka_db
2023-11-13 15:01:30,907 [INFO    ] yandex token valid
2023-11-13 15:01:33,900 [INFO    ] Успешно загружено 1 файлов с личного диска: ['12-11-23 (без дублей).csv'] для avito
2023-11-13 15:01:34,140 [INFO    ] yandex token valid
2023-11-13 15:01:37,946 [INFO    ] Успешно загружено 2 файлов с личного диска: ['циан 03-11-23 (без дублей) new.csv', 'циан 12-11-23 (без дублей).csv'] для cian
2023-11-13 15:01:37,947 [INFO    ] ready to process files ['12-11-23 (без дублей).csv'], ['циан 03-11-23 (без дублей) new.csv', 'циан 12-11-23 (без дублей).csv']
2023-11-13 15:01:48,808 [INFO    ] обновлен status_new в таблице realty
2023-11-13 15:03:06,572 [INFO    ] обновлен status_new в таблице prices
2023-11-13 15:03:06,576 [INFO    ] обработка файла циан 03-11-23 (без дублей) new.csv для cian
2023-11-13 15:03:08,052 [INFO    ] обработка district_id:
2023-11-13 15:03:08,066 [INFO    ] districts_update:   0%|          | 0/113307 [00:00<?, ?it/s]
2023-11-13 15:03:23,067 [INFO    ] districts_update:  13%|#2        | 14284/113307 [00:15<01:43, 952.22it/s]
2023-11-13 15:03:38,067 [INFO    ] districts_update:  26%|##6       | 29712/113307 [00:30<01:23, 997.11it/s]
2023-11-13 15:03:48,130 [INFO    ] districts_update:  36%|###5      | 40323/113307 [00:40<01:13, 997.11it/s]
2023-11-13 15:03:53,067 [INFO    ] districts_update:  40%|####      | 45361/113307 [00:45<01:06, 1018.18it/s]
2023-11-13 15:04:08,154 [INFO    ] districts_update:  53%|#####3    | 60136/113307 [01:00<00:52, 1018.18it/s]
2023-11-13 15:04:08,155 [INFO    ] districts_update:  53%|#####3    | 60137/113307 [01:00<00:53, 1002.79it/s]
2023-11-13 15:04:18,174 [INFO    ] districts_update:  62%|######1   | 70005/113307 [01:10<00:43, 1002.79it/s]
2023-11-13 15:04:23,155 [INFO    ] districts_update:  66%|######6   | 74964/113307 [01:15<00:38, 997.62it/s]
2023-11-13 15:04:38,155 [INFO    ] districts_update:  80%|#######9  | 90615/113307 [01:30<00:22, 1013.17it/s]
2023-11-13 15:04:48,182 [INFO    ] districts_update:  89%|########8 | 100646/113307 [01:40<00:12, 1013.17it/s]
2023-11-13 15:04:53,156 [INFO    ] districts_update:  93%|#########3| 105677/113307 [01:45<00:07, 1010.21it/s]
2023-11-13 15:05:00,519 [INFO    ] districts_update: 100%|##########| 113307/113307 [01:52<00:00, 1007.59it/s]
2023-11-13 15:05:00,520 [INFO    ] 
2023-11-13 15:05:00,527 [INFO    ] district add from realty
2023-11-13 15:05:02,316 [INFO    ] Успешно обработан файл циан 03-11-23 (без дублей) new.csv для realty
2023-11-13 15:05:02,323 [INFO    ] Выгрузка в таблицу realty обработанного файла из cian: циан 03-11-23 (без дублей) new.csv
2023-11-13 15:05:02,481 [INFO    ] Временная таблица очищена
2023-11-13 15:05:14,424 [INFO    ] Загрузка новых объявлений в таблицу
2023-11-13 15:05:14,649 [INFO    ] 111354 существующих и 1953 новых объявлений
2023-11-13 15:05:14,653 [INFO    ] temp таблица очищена, загружаются данные
2023-11-13 15:06:02,831 [INFO    ] обновлена таблица realty
2023-11-13 15:06:26,744 [INFO    ] обновлены районы в таблице realty
2023-11-13 15:06:29,297 [INFO    ] Обновление существующих данных realty завершено
2023-11-13 15:07:03,352 [INFO    ] из новых объяв найдено по адресу 124, запрос в ddt для 284 уник. адресов из 1829
2023-11-13 15:07:03,352 [INFO    ] обновление районов для найденных в realty по адресу новых объявлений:
2023-11-13 15:07:03,523 [INFO    ] обнаружено 6 районов для 8 новых объявлений, найденных по адресу из 12
2023-11-13 15:07:03,544 [INFO    ] 5 районов осталось незаполнено
2023-11-13 15:07:03,546 [INFO    ] переход к обновлению оставшихся (не найденных по адресу) 1829 новых объявлений (284 адресов) для cian
2023-11-13 15:07:03,573 [INFO    ] загрузка данных dadata из /var/www/yadisk_loader/saved_data_csv/cian_dadata_request.csv
2023-11-13 15:07:04,237 [INFO    ] удалось загрузить исторические данные dadata
2023-11-13 15:07:06,246 [INFO    ] количество запросов к dadata составит: 284
2023-11-13 15:07:06,251 [INFO    ] 0%|          | 0/97 [00:00<?, ?it/s]
2023-11-13 15:07:06,941 [INFO    ] 284it [00:00, 411.54it/s]
2023-11-13 15:07:06,941 [INFO    ] 
2023-11-13 15:07:06,941 [INFO    ] dadata con closed succesfully
2023-11-13 15:07:06,942 [INFO    ] обращение к DDT по 187/284 адресам из cian заняло 0:00:03.396019
2023-11-13 15:07:06,952 [INFO    ] обращение к DDT выполнено для 665/1829 новых объявлений, найден fias для 486
2023-11-13 15:08:04,484 [INFO    ] уникальных троек по h_fias_id, ad_id, d_id, в таблице с районами и houses_jkh_ddt/id: 665
2023-11-13 15:08:04,487 [INFO    ] выгрузка данных в таблицу realty
2023-11-13 15:08:05,133 [INFO    ] Добавлено районов к объявлениям realty: 0 - было 1101 стало 1101
2023-11-13 15:08:05,133 [INFO    ] Есть несовпадения районов c jkh, обновление районов в jkh для 0 записей
2023-11-13 15:08:08,298 [INFO    ] Временная таблица temp_jkh_houses очищена
2023-11-13 15:08:11,759 [INFO    ] Обновление данных jkh_houses завершено
2023-11-13 15:08:13,072 [INFO    ] все новые объявления добавлены
2023-11-13 15:08:14,478 [INFO    ] Успешно обработан файл циан 03-11-23 (без дублей) new.csv для prices
2023-11-13 15:08:14,478 [INFO    ] Выгрузка в таблицу prices обработанного файла из cian: циан 03-11-23 (без дублей) new.csv
2023-11-13 15:08:24,901 [INFO    ] данные cian загружены успешно
2023-11-13 15:08:24,901 [INFO    ] обработка файла циан 12-11-23 (без дублей).csv для cian
2023-11-13 15:08:26,131 [INFO    ] обработка district_id:
2023-11-13 15:08:26,132 [INFO    ] districts_update:   0%|          | 0/111787 [00:00<?, ?it/s]
2023-11-13 15:08:41,132 [INFO    ] districts_update:  12%|#2        | 13951/111787 [00:15<01:45, 930.07it/s]
2023-11-13 15:08:56,133 [INFO    ] districts_update:  26%|##5       | 28736/111787 [00:30<01:26, 962.74it/s]
2023-11-13 15:09:08,249 [INFO    ] districts_update:  37%|###7      | 41738/111787 [00:42<01:12, 962.74it/s]
2023-11-13 15:09:11,133 [INFO    ] districts_update:  40%|####      | 44827/111787 [00:45<01:06, 1012.96it/s]
2023-11-13 15:09:27,442 [INFO    ] districts_update:  54%|#####4    | 60918/111787 [01:01<00:50, 1002.04it/s]
2023-11-13 15:09:38,257 [INFO    ] districts_update:  64%|######3   | 71443/111787 [01:12<00:40, 1002.04it/s]
2023-11-13 15:09:42,442 [INFO    ] districts_update:  67%|######7   | 75333/111787 [01:16<00:36, 987.55it/s]
2023-11-13 15:09:57,443 [INFO    ] districts_update:  81%|########  | 90426/111787 [01:31<00:21, 993.79it/s]
2023-11-13 15:10:08,263 [INFO    ] districts_update:  90%|######### | 101059/111787 [01:42<00:10, 993.79it/s]
2023-11-13 15:10:12,443 [INFO    ] districts_update:  94%|#########3| 105078/111787 [01:46<00:06, 988.28it/s]
2023-11-13 15:10:19,169 [INFO    ] districts_update: 100%|##########| 111787/111787 [01:53<00:00, 988.95it/s]
2023-11-13 15:10:19,169 [INFO    ] 
2023-11-13 15:10:19,176 [INFO    ] district add from realty
2023-11-13 15:10:20,184 [INFO    ] Успешно обработан файл циан 12-11-23 (без дублей).csv для realty
2023-11-13 15:10:20,200 [INFO    ] Выгрузка в таблицу realty обработанного файла из cian: циан 12-11-23 (без дублей).csv
2023-11-13 15:10:20,288 [INFO    ] Временная таблица очищена
2023-11-13 15:10:29,894 [INFO    ] Загрузка новых объявлений в таблицу
2023-11-13 15:10:30,107 [INFO    ] 100438 существующих и 11349 новых объявлений
2023-11-13 15:10:30,152 [INFO    ] temp таблица очищена, загружаются данные
2023-11-13 15:11:10,456 [INFO    ] обновлена таблица realty
2023-11-13 15:11:36,208 [INFO    ] обновлены районы в таблице realty
2023-11-13 15:11:39,770 [INFO    ] Обновление существующих данных realty завершено
2023-11-13 15:12:09,539 [INFO    ] из новых объяв найдено по адресу 5160, запрос в ddt для 2337 уник. адресов из 6189
2023-11-13 15:12:09,540 [INFO    ] обновление районов для найденных в realty по адресу новых объявлений:
2023-11-13 15:12:09,723 [INFO    ] обнаружено 162 районов для 209 новых объявлений, найденных по адресу из 293
2023-11-13 15:12:09,758 [INFO    ] 109 районов осталось незаполнено
2023-11-13 15:12:09,763 [INFO    ] переход к обновлению оставшихся (не найденных по адресу) 6189 новых объявлений (2337 адресов) для cian
2023-11-13 15:12:09,792 [INFO    ] загрузка данных dadata из /var/www/yadisk_loader/saved_data_csv/cian_dadata_request.csv
2023-11-13 15:12:10,430 [INFO    ] удалось загрузить исторические данные dadata
2023-11-13 15:12:12,445 [INFO    ] количество запросов к dadata составит: 2337
2023-11-13 15:12:12,452 [INFO    ] 0%|          | 0/367 [00:00<?, ?it/s]
2023-11-13 15:12:18,239 [INFO    ] 2337it [00:05, 403.83it/s]
2023-11-13 15:12:18,239 [INFO    ] 
2023-11-13 15:12:18,239 [INFO    ] dadata con closed succesfully
2023-11-13 15:12:18,241 [INFO    ] обращение к DDT по 1990/2337 адресам из cian заняло 0:00:08.478177
2023-11-13 15:12:18,265 [INFO    ] обращение к DDT выполнено для 4295/6189 новых объявлений, найден fias для 3178
2023-11-13 15:13:19,795 [INFO    ] уникальных троек по h_fias_id, ad_id, d_id, в таблице с районами и houses_jkh_ddt/id: 4295
2023-11-13 15:13:19,801 [INFO    ] выгрузка данных в таблицу realty
2023-11-13 15:13:21,886 [INFO    ] Добавлено районов к объявлениям realty: 8 - было 4730 стало 4738
2023-11-13 15:13:21,886 [INFO    ] Есть несовпадения районов c jkh, обновление районов в jkh для 48 записей
2023-11-13 15:13:25,045 [INFO    ] Временная таблица temp_jkh_houses очищена
2023-11-13 15:13:28,508 [INFO    ] Обновление данных jkh_houses завершено
2023-11-13 15:13:32,449 [INFO    ] все новые объявления добавлены
2023-11-13 15:13:33,823 [INFO    ] Успешно обработан файл циан 12-11-23 (без дублей).csv для prices
2023-11-13 15:13:33,824 [INFO    ] Выгрузка в таблицу prices обработанного файла из cian: циан 12-11-23 (без дублей).csv
2023-11-13 15:13:43,853 [INFO    ] данные cian загружены успешно
2023-11-13 15:13:43,944 [INFO    ] обработка файла 12-11-23 (без дублей).csv для авито
2023-11-13 15:14:25,370 [INFO    ] Успешно обработан файл 12-11-23 (без дублей).csv для realty
2023-11-13 15:14:25,405 [INFO    ] Выгрузка в таблицу realty обработанного файла из авито: 12-11-23 (без дублей).csv
2023-11-13 15:14:25,553 [INFO    ] Временная таблица очищена
2023-11-13 15:14:29,438 [INFO    ] Загрузка новых объявлений в таблицу
2023-11-13 15:14:29,584 [INFO    ] 155223 существующих и 14988 новых объявлений
2023-11-13 15:14:29,632 [INFO    ] temp таблица очищена, загружаются данные
2023-11-13 15:15:19,499 [INFO    ] обновлена таблица realty
2023-11-13 15:15:21,886 [INFO    ] обновлены районы в таблице realty
2023-11-13 15:15:27,508 [INFO    ] Обновление существующих данных realty завершено
2023-11-13 15:15:56,134 [INFO    ] из новых объяв найдено по адресу 5291, запрос в ddt для 3403 уник. адресов из 9697
2023-11-13 15:15:56,136 [INFO    ] обновление районов для найденных в realty по адресу новых объявлений:
2023-11-13 15:15:56,619 [INFO    ] обнаружено 1804 районов для 3117 новых объявлений, найденных по адресу из 5291
2023-11-13 15:15:56,630 [INFO    ] 1321 районов осталось незаполнено
2023-11-13 15:15:56,633 [INFO    ] переход к обновлению оставшихся (не найденных по адресу) 9697 новых объявлений (3403 адресов) для avito
2023-11-13 15:15:56,647 [INFO    ] загрузка данных dadata из /var/www/yadisk_loader/saved_data_csv/avito_dadata_request.csv
2023-11-13 15:15:57,747 [INFO    ] удалось загрузить исторические данные dadata
2023-11-13 15:15:59,768 [INFO    ] количество запросов к dadata составит: 3403
2023-11-13 15:15:59,776 [INFO    ] 0%|          | 0/315 [00:00<?, ?it/s]
2023-11-13 15:16:09,776 [INFO    ] 3238it [00:10, 323.79it/s]
2023-11-13 15:16:10,280 [INFO    ] 3403it [00:10, 323.95it/s]
2023-11-13 15:16:10,281 [INFO    ] 
2023-11-13 15:16:10,281 [INFO    ] dadata con closed succesfully
2023-11-13 15:16:10,283 [INFO    ] обращение к DDT по 3196/3403 адресам из avito заняло 0:00:13.650462
2023-11-13 15:16:10,343 [INFO    ] обращение к DDT выполнено для 8732/9697 новых объявлений, найден fias для 5288
2023-11-13 15:16:38,827 [INFO    ] уникальных троек по h_fias_id, ad_id, d_id, в таблице с районами и houses_jkh_ddt/id: 8732
2023-11-13 15:16:38,829 [INFO    ] выгрузка данных в таблицу realty
2023-11-13 15:16:41,868 [INFO    ] Добавлено районов к объявлениям realty: 948 - было 0 стало 948
2023-11-13 15:16:41,868 [INFO    ] Есть несовпадения районов c jkh, обновление районов в jkh для 0 записей
2023-11-13 15:16:45,024 [INFO    ] Временная таблица temp_jkh_houses очищена
2023-11-13 15:16:48,396 [INFO    ] Обновление данных jkh_houses завершено
2023-11-13 15:16:53,257 [INFO    ] все новые объявления добавлены
2023-11-13 15:16:55,250 [INFO    ] Успешно обработан файл 12-11-23 (без дублей).csv для prices
2023-11-13 15:16:55,250 [INFO    ] Выгрузка в таблицу prices обработанного файла из авито: 12-11-23 (без дублей).csv
2023-11-13 15:17:11,301 [INFO    ] данные avito загружены успешно
2023-11-13 15:17:11,786 [INFO    ] Новые данные загружены по файлам ['12-11-23 (без дублей).csv'] из авито и ['циан 03-11-23 (без дублей) new.csv', 'циан 12-11-23 (без дублей).csv'] из циана за 0:15:41.384069
2023-11-13 15:17:11,891 [INFO    ] HTTP Request: GET https://dadata.ru/api/v2/profile/balance "HTTP/1.1 200 OK"
2023-11-13 15:17:11,896 [INFO    ] сохранение лог-файла
