2023-08-21 15:57:56,857 [INFO    ] Скрипт запущен: 2023-08-21 15:57:56.857452
2023-08-21 15:57:56,891 [INFO    ] Connected (version 2.0, client OpenSSH_7.4p1)
2023-08-21 15:57:56,939 [INFO    ] Authentication (publickey) failed.
2023-08-21 15:57:56,942 [INFO    ] Connected (version 2.0, client OpenSSH_7.4p1)
2023-08-21 15:57:56,993 [INFO    ] Authentication (password) successful!
2023-08-21 15:57:57,005 [INFO    ] connected to host 92.53.64.66 base app_nedvizhka_db
2023-08-21 15:57:57,110 [INFO    ] yandex token valid
2023-08-21 15:57:59,930 [INFO    ] Успешно загружено 1 файлов с личного диска: ['20-08-23 (без дублей).csv'] для avito
2023-08-21 15:58:00,308 [INFO    ] yandex token valid
2023-08-21 15:58:03,297 [INFO    ] Успешно загружено 1 файлов с личного диска: ['циан 20-08-23 (без дублей).csv'] для cian
2023-08-21 15:58:03,297 [INFO    ] ready to process files ['20-08-23 (без дублей).csv'], ['циан 20-08-23 (без дублей).csv']
2023-08-21 15:58:03,431 [INFO    ] обработка файла циан 20-08-23 (без дублей).csv для cian
2023-08-21 15:58:04,565 [INFO    ] обработка district_id:
2023-08-21 15:58:04,568 [INFO    ] districts_update:   0%|          | 0/117639 [00:00<?, ?it/s]
2023-08-21 15:58:19,568 [INFO    ] districts_update:  12%|#2        | 14470/117639 [00:15<01:46, 964.65it/s]
2023-08-21 15:58:34,569 [INFO    ] districts_update:  25%|##4       | 29008/117639 [00:30<01:31, 967.30it/s]
2023-08-21 15:58:44,602 [INFO    ] districts_update:  33%|###2      | 38746/117639 [00:40<01:21, 967.30it/s]
2023-08-21 15:58:49,569 [INFO    ] districts_update:  37%|###7      | 43621/117639 [00:45<01:16, 970.44it/s]
2023-08-21 15:59:04,570 [INFO    ] districts_update:  50%|####9     | 58394/117639 [01:00<01:00, 976.11it/s]
2023-08-21 15:59:14,619 [INFO    ] districts_update:  58%|#####8    | 68374/117639 [01:10<00:50, 976.11it/s]
2023-08-21 15:59:19,571 [INFO    ] districts_update:  62%|######2   | 73244/117639 [01:15<00:45, 981.11it/s]
2023-08-21 15:59:34,571 [INFO    ] districts_update:  75%|#######4  | 88104/117639 [01:30<00:30, 984.35it/s]
2023-08-21 15:59:44,652 [INFO    ] districts_update:  83%|########2 | 97634/117639 [01:40<00:20, 984.35it/s]
2023-08-21 15:59:49,572 [INFO    ] districts_update:  87%|########7 | 102471/117639 [01:45<00:15, 975.66it/s]
2023-08-21 16:00:04,572 [INFO    ] districts_update: 100%|#########9| 117187/117639 [02:00<00:00, 977.37it/s]
2023-08-21 16:00:05,058 [INFO    ] districts_update: 100%|##########| 117639/117639 [02:00<00:00, 976.34it/s]
2023-08-21 16:00:05,058 [INFO    ] 
2023-08-21 16:00:05,065 [INFO    ] district add from realty
2023-08-21 16:00:05,930 [INFO    ] Успешно обработан файл циан 20-08-23 (без дублей).csv для realty
2023-08-21 16:00:05,979 [INFO    ] Выгрузка в таблицу realty обработанного файла из cian: циан 20-08-23 (без дублей).csv
2023-08-21 16:00:06,066 [INFO    ] Временная таблица очищена
2023-08-21 16:00:12,812 [INFO    ] Загрузка новых объявлений в таблицу
2023-08-21 16:00:13,059 [INFO    ] 115290 существующих и 2349 новых объявлений
2023-08-21 16:00:13,103 [INFO    ] temp таблица очищена, загружаются данные
2023-08-21 16:00:55,016 [INFO    ] обновлена таблица realty
2023-08-21 16:01:10,892 [INFO    ] обновлены районы в таблице realty
2023-08-21 16:01:17,522 [INFO    ] Обновление существующих данных realty завершено
2023-08-21 16:01:39,222 [INFO    ] из новых объяв найдено по адресу 1047, запрос в ddt для 646 уник. адресов из 1302
2023-08-21 16:01:39,222 [INFO    ] обновление районов для найденных в realty по адресу новых объявлений:
2023-08-21 16:01:39,318 [INFO    ] обнаружено 40 районов для 40 новых объявлений, найденных по адресу из 61
2023-08-21 16:01:39,323 [INFO    ] 36 районов осталось незаполнено
2023-08-21 16:01:39,324 [INFO    ] переход к обновлению оставшихся (не найденных по адресу) 1302 новых объявлений (646 адресов) для cian
2023-08-21 16:01:39,337 [INFO    ] загрузка данных dadata из /var/www/yadisk_loader/saved_data_csv/cian_dadata_request.csv
2023-08-21 16:01:39,596 [INFO    ] удалось загрузить исторические данные dadata
2023-08-21 16:01:41,601 [INFO    ] количество запросов к dadata составит: 646
2023-08-21 16:01:41,602 [INFO    ] 0%|          | 0/130 [00:00<?, ?it/s]
2023-08-21 16:01:42,916 [INFO    ] 646it [00:01, 491.73it/s]
2023-08-21 16:01:42,916 [INFO    ] 
2023-08-21 16:01:42,916 [INFO    ] dadata con closed succesfully
2023-08-21 16:01:42,917 [INFO    ] обращение к DDT по 516/646 адресам из cian заняло 0:00:03.593051
2023-08-21 16:01:42,927 [INFO    ] обращение к DDT выполнено для 773/1302 новых объявлений, найден fias для 582
2023-08-21 16:02:02,284 [INFO    ] уникальных троек по h_fias_id, ad_id, d_id, в таблице с районами и houses_jkh_ddt/id: 773
2023-08-21 16:02:02,285 [INFO    ] выгрузка данных в таблицу realty
2023-08-21 16:02:02,712 [INFO    ] Добавлено районов к объявлениям realty: 2 - было 849 стало 851
2023-08-21 16:02:02,712 [INFO    ] Есть несовпадения районов c jkh, обновление районов в jkh для 2 записей
2023-08-21 16:02:09,369 [INFO    ] Временная таблица temp_jkh_houses создана
2023-08-21 16:02:12,538 [INFO    ] Обновление данных jkh_houses завершено
2023-08-21 16:02:13,789 [INFO    ] все новые объявления добавлены
2023-08-21 16:02:15,040 [INFO    ] Успешно обработан файл циан 20-08-23 (без дублей).csv для prices
2023-08-21 16:02:15,040 [INFO    ] Выгрузка в таблицу prices обработанного файла из cian: циан 20-08-23 (без дублей).csv
2023-08-21 16:02:27,016 [INFO    ] данные cian загружены успешно
2023-08-21 16:02:27,103 [INFO    ] обработка файла 20-08-23 (без дублей).csv для авито
2023-08-21 16:03:06,149 [INFO    ] Успешно обработан файл 20-08-23 (без дублей).csv для realty
2023-08-21 16:03:06,219 [INFO    ] Выгрузка в таблицу realty обработанного файла из авито: 20-08-23 (без дублей).csv
2023-08-21 16:03:06,307 [INFO    ] Временная таблица очищена
2023-08-21 16:03:07,958 [INFO    ] Загрузка новых объявлений в таблицу
2023-08-21 16:03:08,063 [INFO    ] 157990 существующих и 1327 новых объявлений
2023-08-21 16:03:08,107 [INFO    ] temp таблица очищена, загружаются данные
2023-08-21 16:03:52,659 [INFO    ] обновлена таблица realty
2023-08-21 16:03:54,549 [INFO    ] обновлены районы в таблице realty
2023-08-21 16:03:58,873 [INFO    ] Обновление существующих данных realty завершено
2023-08-21 16:04:19,275 [INFO    ] из новых объяв найдено по адресу 333, запрос в ddt для 615 уник. адресов из 994
2023-08-21 16:04:19,276 [INFO    ] обновление районов для найденных в realty по адресу новых объявлений:
2023-08-21 16:04:19,505 [INFO    ] обнаружено 305 районов для 305 новых объявлений, найденных по адресу из 333
2023-08-21 16:04:19,510 [INFO    ] 15 районов осталось незаполнено
2023-08-21 16:04:19,510 [INFO    ] переход к обновлению оставшихся (не найденных по адресу) 994 новых объявлений (615 адресов) для avito
2023-08-21 16:04:19,523 [INFO    ] загрузка данных dadata из /var/www/yadisk_loader/saved_data_csv/avito_dadata_request.csv
2023-08-21 16:04:19,873 [INFO    ] удалось загрузить исторические данные dadata
2023-08-21 16:04:21,878 [INFO    ] количество запросов к dadata составит: 615
2023-08-21 16:04:21,879 [INFO    ] 0%|          | 0/35 [00:00<?, ?it/s]
2023-08-21 16:04:23,252 [INFO    ] 615it [00:01, 447.99it/s]
2023-08-21 16:04:23,252 [INFO    ] 
2023-08-21 16:04:23,252 [INFO    ] dadata con closed succesfully
2023-08-21 16:04:23,253 [INFO    ] обращение к DDT по 580/615 адресам из avito заняло 0:00:03.742762
2023-08-21 16:04:23,263 [INFO    ] обращение к DDT выполнено для 926/994 новых объявлений, найден fias для 653
2023-08-21 16:04:45,463 [INFO    ] уникальных троек по h_fias_id, ad_id, d_id, в таблице с районами и houses_jkh_ddt/id: 926
2023-08-21 16:04:45,464 [INFO    ] выгрузка данных в таблицу realty
2023-08-21 16:04:45,781 [INFO    ] Добавлено районов к объявлениям realty: 164 - было 0 стало 164
2023-08-21 16:04:45,781 [INFO    ] Есть несовпадения районов c jkh, обновление районов в jkh для 0 записей
2023-08-21 16:04:48,918 [INFO    ] Временная таблица temp_jkh_houses очищена
2023-08-21 16:04:52,145 [INFO    ] Обновление данных jkh_houses завершено
2023-08-21 16:04:52,986 [INFO    ] все новые объявления добавлены
2023-08-21 16:04:54,632 [INFO    ] Успешно обработан файл 20-08-23 (без дублей).csv для prices
2023-08-21 16:04:54,632 [INFO    ] Выгрузка в таблицу prices обработанного файла из авито: 20-08-23 (без дублей).csv
2023-08-21 16:05:08,778 [INFO    ] данные avito загружены успешно
2023-08-21 16:05:09,163 [INFO    ] Новые данные загружены по файлам ['20-08-23 (без дублей).csv'] из авито и ['циан 20-08-23 (без дублей).csv'] из циана за 0:07:12.305876
2023-08-21 16:05:09,241 [INFO    ] HTTP Request: GET https://dadata.ru/api/v2/profile/balance "HTTP/1.1 200 OK"
2023-08-21 16:05:09,252 [ERROR   ] Traceback (most recent call last):
  File "/var/www/yadisk_loader/report_utils.py", line 145, in report_text
    i[1] = " ".join(i[1].replace(' ', '').replace('(', ' (').split())
IndexError: list index out of range

2023-08-21 16:05:09,530 [INFO    ] отчет отправлен в tg
2023-08-21 16:05:09,753 [INFO    ] сохранение лог-файла
