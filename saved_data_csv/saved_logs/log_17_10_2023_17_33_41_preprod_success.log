2023-10-17 17:17:17,499 [INFO    ] Скрипт запущен: 2023-10-17 17:17:17.499180
2023-10-17 17:17:17,532 [INFO    ] Connected (version 2.0, client OpenSSH_7.4p1)
2023-10-17 17:17:17,581 [INFO    ] Authentication (publickey) failed.
2023-10-17 17:17:17,585 [INFO    ] Connected (version 2.0, client OpenSSH_7.4p1)
2023-10-17 17:17:17,638 [INFO    ] Authentication (password) successful!
2023-10-17 17:17:17,681 [INFO    ] connected to host 92.53.64.66 base preprod_nedvizhka_db
2023-10-17 17:17:17,826 [INFO    ] yandex token valid
2023-10-17 17:17:22,260 [INFO    ] Успешно загружено 2 файлов с личного диска: ['15-10-23 (без дублей).csv', '16-10-23 (без дублей).csv'] для avito
2023-10-17 17:17:22,416 [INFO    ] yandex token valid
2023-10-17 17:17:26,400 [INFO    ] Успешно загружено 2 файлов с личного диска: ['циан 15-10-23 (без дублей).csv', 'циан 16-10-23 (без дублей).csv'] для cian
2023-10-17 17:17:26,400 [INFO    ] ready to process files ['15-10-23 (без дублей).csv', '16-10-23 (без дублей).csv'], ['циан 15-10-23 (без дублей).csv', 'циан 16-10-23 (без дублей).csv']
2023-10-17 17:17:34,443 [INFO    ] обновлен status_new в таблице realty
2023-10-17 17:17:44,374 [INFO    ] обновлен status_new в таблице prices
2023-10-17 17:17:44,374 [INFO    ] обработка файла циан 15-10-23 (без дублей).csv для cian
2023-10-17 17:17:45,478 [INFO    ] обработка district_id:
2023-10-17 17:17:45,483 [INFO    ] districts_update:   0%|          | 0/109190 [00:00<?, ?it/s]
2023-10-17 17:18:00,484 [INFO    ] districts_update:  13%|#2        | 13705/109190 [00:15<01:44, 913.65it/s]
2023-10-17 17:18:15,484 [INFO    ] districts_update:  26%|##6       | 28796/109190 [00:30<01:23, 967.99it/s]
2023-10-17 17:18:25,518 [INFO    ] districts_update:  36%|###5      | 39002/109190 [00:40<01:12, 967.99it/s]
2023-10-17 17:18:30,485 [INFO    ] districts_update:  40%|####      | 44020/109190 [00:45<01:05, 989.41it/s]
2023-10-17 17:18:45,521 [INFO    ] districts_update:  54%|#####3    | 58501/109190 [01:00<00:51, 989.41it/s]
2023-10-17 17:18:45,521 [INFO    ] districts_update:  54%|#####3    | 58502/109190 [01:00<00:51, 979.01it/s]
2023-10-17 17:18:55,528 [INFO    ] districts_update:  62%|######2   | 68191/109190 [01:10<00:41, 979.01it/s]
2023-10-17 17:19:00,522 [INFO    ] districts_update:  67%|######7   | 73165/109190 [01:15<00:36, 978.46it/s]
2023-10-17 17:19:15,522 [INFO    ] districts_update:  81%|########  | 88018/109190 [01:30<00:21, 982.45it/s]
2023-10-17 17:19:25,534 [INFO    ] districts_update:  90%|########9 | 97780/109190 [01:40<00:11, 982.45it/s]
2023-10-17 17:19:30,523 [INFO    ] districts_update:  94%|#########4| 102811/109190 [01:45<00:06, 983.66it/s]
2023-10-17 17:19:36,946 [INFO    ] districts_update: 100%|##########| 109190/109190 [01:51<00:00, 979.61it/s]
2023-10-17 17:19:36,947 [INFO    ] 
2023-10-17 17:19:36,953 [INFO    ] district add from realty
2023-10-17 17:19:39,251 [INFO    ] Успешно обработан файл циан 15-10-23 (без дублей).csv для realty
2023-10-17 17:19:39,299 [INFO    ] Выгрузка в таблицу realty обработанного файла из cian: циан 15-10-23 (без дублей).csv
2023-10-17 17:19:39,525 [INFO    ] Временная таблица создана
2023-10-17 17:19:48,084 [INFO    ] Загрузка новых объявлений в таблицу
2023-10-17 17:19:48,292 [INFO    ] 107371 существующих и 1819 новых объявлений
2023-10-17 17:19:48,335 [INFO    ] temp таблица очищена, загружаются данные
2023-10-17 17:20:50,141 [INFO    ] обновлена таблица realty
2023-10-17 17:21:16,758 [INFO    ] обновлены районы в таблице realty
2023-10-17 17:21:19,010 [INFO    ] Обновление существующих данных realty завершено
2023-10-17 17:21:48,135 [INFO    ] из новых объяв найдено по адресу 402, запрос в ddt для 385 уник. адресов из 1417
2023-10-17 17:21:48,135 [INFO    ] обновление районов для найденных в realty по адресу новых объявлений:
2023-10-17 17:21:48,188 [INFO    ] обнаружено 20 районов для 29 новых объявлений, найденных по адресу из 50
2023-10-17 17:21:48,193 [INFO    ] 23 районов осталось незаполнено
2023-10-17 17:21:48,194 [INFO    ] переход к обновлению оставшихся (не найденных по адресу) 1417 новых объявлений (385 адресов) для cian
2023-10-17 17:21:48,206 [INFO    ] загрузка данных dadata из /var/www/yadisk_loader/saved_data_csv/cian_dadata_request.csv
2023-10-17 17:21:48,867 [INFO    ] удалось загрузить исторические данные dadata
2023-10-17 17:21:50,874 [INFO    ] количество запросов к dadata составит: 385
2023-10-17 17:21:50,875 [INFO    ] 0%|          | 0/98 [00:00<?, ?it/s]
2023-10-17 17:21:51,734 [INFO    ] 385it [00:00, 448.12it/s]
2023-10-17 17:21:51,735 [INFO    ] 
2023-10-17 17:21:51,735 [INFO    ] dadata con closed succesfully
2023-10-17 17:21:51,736 [INFO    ] обращение к DDT по 287/385 адресам из cian заняло 0:00:03.541945
2023-10-17 17:21:51,745 [INFO    ] обращение к DDT выполнено для 650/1417 новых объявлений, найден fias для 396
2023-10-17 17:22:43,361 [INFO    ] уникальных троек по h_fias_id, ad_id, d_id, в таблице с районами и houses_jkh_ddt/id: 650
2023-10-17 17:22:43,363 [INFO    ] выгрузка данных в таблицу realty
2023-10-17 17:22:43,853 [INFO    ] Добавлено районов к объявлениям realty: 0 - было 802 стало 802
2023-10-17 17:22:43,853 [INFO    ] Есть несовпадения районов c jkh, обновление районов в jkh для 4 записей
2023-10-17 17:22:50,159 [INFO    ] Временная таблица temp_jkh_houses создана
2023-10-17 17:22:53,498 [INFO    ] Обновление данных jkh_houses завершено
2023-10-17 17:22:54,303 [INFO    ] все новые объявления добавлены
2023-10-17 17:22:56,339 [INFO    ] Успешно обработан файл циан 15-10-23 (без дублей).csv для prices
2023-10-17 17:22:56,339 [INFO    ] Выгрузка в таблицу prices обработанного файла из cian: циан 15-10-23 (без дублей).csv
2023-10-17 17:23:06,740 [INFO    ] данные cian загружены успешно
2023-10-17 17:23:06,740 [INFO    ] обработка файла циан 16-10-23 (без дублей).csv для cian
2023-10-17 17:23:08,006 [INFO    ] обработка district_id:
2023-10-17 17:23:08,007 [INFO    ] districts_update:   0%|          | 0/108167 [00:00<?, ?it/s]
2023-10-17 17:23:23,008 [INFO    ] districts_update:  13%|#2        | 13920/108167 [00:15<01:41, 927.95it/s]
2023-10-17 17:23:35,677 [INFO    ] districts_update:  25%|##4       | 26698/108167 [00:27<01:27, 927.95it/s]
2023-10-17 17:23:38,008 [INFO    ] districts_update:  27%|##7       | 29550/108167 [00:30<01:19, 995.01it/s]
2023-10-17 17:23:53,510 [INFO    ] districts_update:  42%|####1     | 45180/108167 [00:45<01:02, 1001.18it/s]
2023-10-17 17:24:05,687 [INFO    ] districts_update:  53%|#####2    | 57198/108167 [00:57<00:50, 1001.18it/s]
2023-10-17 17:24:08,511 [INFO    ] districts_update:  56%|#####5    | 60158/108167 [01:00<00:48, 1000.12it/s]
2023-10-17 17:24:24,543 [INFO    ] districts_update:  69%|######9   | 75135/108167 [01:16<00:33, 975.46it/s]
2023-10-17 17:24:35,700 [INFO    ] districts_update:  80%|########  | 86654/108167 [01:27<00:22, 975.46it/s]
2023-10-17 17:24:39,544 [INFO    ] districts_update:  84%|########3 | 90465/108167 [01:31<00:17, 990.95it/s]
2023-10-17 17:24:54,860 [INFO    ] districts_update:  98%|#########7| 105795/108167 [01:46<00:02, 994.20it/s]
2023-10-17 17:24:57,237 [INFO    ] districts_update: 100%|##########| 108167/108167 [01:49<00:00, 990.27it/s]
2023-10-17 17:24:57,238 [INFO    ] 
2023-10-17 17:24:57,244 [INFO    ] district add from realty
2023-10-17 17:24:58,241 [INFO    ] Успешно обработан файл циан 16-10-23 (без дублей).csv для realty
2023-10-17 17:24:58,294 [INFO    ] Выгрузка в таблицу realty обработанного файла из cian: циан 16-10-23 (без дублей).csv
2023-10-17 17:24:58,471 [INFO    ] Временная таблица очищена
2023-10-17 17:25:09,548 [INFO    ] Загрузка новых объявлений в таблицу
2023-10-17 17:25:09,753 [INFO    ] 104543 существующих и 3624 новых объявлений
2023-10-17 17:25:09,799 [INFO    ] temp таблица очищена, загружаются данные
2023-10-17 17:25:48,761 [INFO    ] обновлена таблица realty
2023-10-17 17:26:10,578 [INFO    ] обновлены районы в таблице realty
2023-10-17 17:26:12,723 [INFO    ] Обновление существующих данных realty завершено
2023-10-17 17:26:40,286 [INFO    ] из новых объяв найдено по адресу 1392, запрос в ddt для 842 уник. адресов из 2232
2023-10-17 17:26:40,287 [INFO    ] обновление районов для найденных в realty по адресу новых объявлений:
2023-10-17 17:26:40,512 [INFO    ] обнаружено 120 районов для 170 новых объявлений, найденных по адресу из 225
2023-10-17 17:26:40,517 [INFO    ] 121 районов осталось незаполнено
2023-10-17 17:26:40,518 [INFO    ] переход к обновлению оставшихся (не найденных по адресу) 2232 новых объявлений (842 адресов) для cian
2023-10-17 17:26:40,531 [INFO    ] загрузка данных dadata из /var/www/yadisk_loader/saved_data_csv/cian_dadata_request.csv
2023-10-17 17:26:41,074 [INFO    ] удалось загрузить исторические данные dadata
2023-10-17 17:26:43,081 [INFO    ] количество запросов к dadata составит: 842
2023-10-17 17:26:43,083 [INFO    ] 0%|          | 0/193 [00:00<?, ?it/s]
2023-10-17 17:26:44,912 [INFO    ] 842it [00:01, 460.16it/s]
2023-10-17 17:26:44,913 [INFO    ] 
2023-10-17 17:26:44,913 [INFO    ] dadata con closed succesfully
2023-10-17 17:26:44,914 [INFO    ] обращение к DDT по 651/842 адресам из cian заняло 0:00:04.395964
2023-10-17 17:26:44,926 [INFO    ] обращение к DDT выполнено для 1293/2232 новых объявлений, найден fias для 915
2023-10-17 17:27:08,825 [INFO    ] уникальных троек по h_fias_id, ad_id, d_id, в таблице с районами и houses_jkh_ddt/id: 1293
2023-10-17 17:27:08,825 [INFO    ] выгрузка данных в таблицу realty
2023-10-17 17:27:09,550 [INFO    ] Добавлено районов к объявлениям realty: 4 - было 1484 стало 1488
2023-10-17 17:27:09,550 [INFO    ] Есть несовпадения районов c jkh, обновление районов в jkh для 8 записей
2023-10-17 17:27:12,643 [INFO    ] Временная таблица temp_jkh_houses очищена
2023-10-17 17:27:16,034 [INFO    ] Обновление данных jkh_houses завершено
2023-10-17 17:27:17,376 [INFO    ] все новые объявления добавлены
2023-10-17 17:27:18,627 [INFO    ] Успешно обработан файл циан 16-10-23 (без дублей).csv для prices
2023-10-17 17:27:18,627 [INFO    ] Выгрузка в таблицу prices обработанного файла из cian: циан 16-10-23 (без дублей).csv
2023-10-17 17:27:27,710 [INFO    ] данные cian загружены успешно
2023-10-17 17:27:27,754 [INFO    ] обработка файла 15-10-23 (без дублей).csv для авито
2023-10-17 17:28:11,935 [INFO    ] Успешно обработан файл 15-10-23 (без дублей).csv для realty
2023-10-17 17:28:12,014 [INFO    ] Выгрузка в таблицу realty обработанного файла из авито: 15-10-23 (без дублей).csv
2023-10-17 17:28:12,103 [INFO    ] Временная таблица очищена
2023-10-17 17:28:15,521 [INFO    ] Загрузка новых объявлений в таблицу
2023-10-17 17:28:15,678 [INFO    ] 178137 существующих и 1528 новых объявлений
2023-10-17 17:28:15,723 [INFO    ] temp таблица очищена, загружаются данные
2023-10-17 17:29:10,228 [INFO    ] обновлена таблица realty
2023-10-17 17:29:12,238 [INFO    ] обновлены районы в таблице realty
2023-10-17 17:29:16,719 [INFO    ] Обновление существующих данных realty завершено
2023-10-17 17:29:43,633 [INFO    ] из новых объяв найдено по адресу 424, запрос в ddt для 492 уник. адресов из 1104
2023-10-17 17:29:43,633 [INFO    ] обновление районов для найденных в realty по адресу новых объявлений:
2023-10-17 17:29:43,860 [INFO    ] обнаружено 187 районов для 358 новых объявлений, найденных по адресу из 424
2023-10-17 17:29:43,865 [INFO    ] 171 районов осталось незаполнено
2023-10-17 17:29:43,866 [INFO    ] переход к обновлению оставшихся (не найденных по адресу) 1104 новых объявлений (492 адресов) для avito
2023-10-17 17:29:43,879 [INFO    ] загрузка данных dadata из /var/www/yadisk_loader/saved_data_csv/avito_dadata_request.csv
2023-10-17 17:29:45,084 [INFO    ] удалось загрузить исторические данные dadata
2023-10-17 17:29:47,092 [INFO    ] количество запросов к dadata составит: 492
2023-10-17 17:29:47,093 [INFO    ] 0%|          | 0/36 [00:00<?, ?it/s]
2023-10-17 17:29:48,440 [INFO    ] 492it [00:01, 365.53it/s]
2023-10-17 17:29:48,440 [INFO    ] 
2023-10-17 17:29:48,440 [INFO    ] dadata con closed succesfully
2023-10-17 17:29:48,441 [INFO    ] обращение к DDT по 458/492 адресам из avito заняло 0:00:04.574778
2023-10-17 17:29:48,450 [INFO    ] обращение к DDT выполнено для 949/1104 новых объявлений, найден fias для 510
2023-10-17 17:30:10,035 [INFO    ] уникальных троек по h_fias_id, ad_id, d_id, в таблице с районами и houses_jkh_ddt/id: 949
2023-10-17 17:30:10,036 [INFO    ] выгрузка данных в таблицу realty
2023-10-17 17:30:10,379 [INFO    ] Добавлено районов к объявлениям realty: 91 - было 0 стало 91
2023-10-17 17:30:10,379 [INFO    ] Есть несовпадения районов c jkh, обновление районов в jkh для 0 записей
2023-10-17 17:30:13,515 [INFO    ] Временная таблица temp_jkh_houses очищена
2023-10-17 17:30:16,658 [INFO    ] Обновление данных jkh_houses завершено
2023-10-17 17:30:17,362 [INFO    ] все новые объявления добавлены
2023-10-17 17:30:19,339 [INFO    ] Успешно обработан файл 15-10-23 (без дублей).csv для prices
2023-10-17 17:30:19,340 [INFO    ] Выгрузка в таблицу prices обработанного файла из авито: 15-10-23 (без дублей).csv
2023-10-17 17:30:34,417 [INFO    ] данные avito загружены успешно
2023-10-17 17:30:34,417 [INFO    ] обработка файла 16-10-23 (без дублей).csv для авито
2023-10-17 17:31:17,054 [INFO    ] Успешно обработан файл 16-10-23 (без дублей).csv для realty
2023-10-17 17:31:17,141 [INFO    ] Выгрузка в таблицу realty обработанного файла из авито: 16-10-23 (без дублей).csv
2023-10-17 17:31:17,231 [INFO    ] Временная таблица очищена
2023-10-17 17:31:20,302 [INFO    ] Загрузка новых объявлений в таблицу
2023-10-17 17:31:20,457 [INFO    ] 167654 существующих и 6117 новых объявлений
2023-10-17 17:31:20,503 [INFO    ] temp таблица очищена, загружаются данные
2023-10-17 17:32:10,597 [INFO    ] обновлена таблица realty
2023-10-17 17:32:12,471 [INFO    ] обновлены районы в таблице realty
2023-10-17 17:32:19,550 [INFO    ] Обновление существующих данных realty завершено
2023-10-17 17:32:44,664 [INFO    ] из новых объяв найдено по адресу 1404, запрос в ddt для 754 уник. адресов из 4713
2023-10-17 17:32:44,665 [INFO    ] обновление районов для найденных в realty по адресу новых объявлений:
2023-10-17 17:32:44,814 [INFO    ] обнаружено 400 районов для 783 новых объявлений, найденных по адресу из 1404
2023-10-17 17:32:44,819 [INFO    ] 384 районов осталось незаполнено
2023-10-17 17:32:44,820 [INFO    ] переход к обновлению оставшихся (не найденных по адресу) 4713 новых объявлений (754 адресов) для avito
2023-10-17 17:32:44,833 [INFO    ] загрузка данных dadata из /var/www/yadisk_loader/saved_data_csv/avito_dadata_request.csv
2023-10-17 17:32:45,683 [INFO    ] удалось загрузить исторические данные dadata
2023-10-17 17:32:47,692 [INFO    ] количество запросов к dadata составит: 754
2023-10-17 17:32:47,696 [INFO    ] 0%|          | 0/56 [00:00<?, ?it/s]
2023-10-17 17:32:49,761 [INFO    ] 754it [00:02, 365.20it/s]
2023-10-17 17:32:49,761 [INFO    ] 
2023-10-17 17:32:49,761 [INFO    ] dadata con closed succesfully
2023-10-17 17:32:49,762 [INFO    ] обращение к DDT по 704/754 адресам из avito заняло 0:00:04.942107
2023-10-17 17:32:49,778 [INFO    ] обращение к DDT выполнено для 4584/4713 новых объявлений, найден fias для 1393
2023-10-17 17:33:13,778 [INFO    ] уникальных троек по h_fias_id, ad_id, d_id, в таблице с районами и houses_jkh_ddt/id: 4584
2023-10-17 17:33:13,779 [INFO    ] выгрузка данных в таблицу realty
2023-10-17 17:33:15,249 [INFO    ] Добавлено районов к объявлениям realty: 151 - было 0 стало 151
2023-10-17 17:33:15,250 [INFO    ] Есть несовпадения районов c jkh, обновление районов в jkh для 0 записей
2023-10-17 17:33:18,387 [INFO    ] Временная таблица temp_jkh_houses очищена
2023-10-17 17:33:21,703 [INFO    ] Обновление данных jkh_houses завершено
2023-10-17 17:33:23,957 [INFO    ] все новые объявления добавлены
2023-10-17 17:33:25,941 [INFO    ] Успешно обработан файл 16-10-23 (без дублей).csv для prices
2023-10-17 17:33:25,941 [INFO    ] Выгрузка в таблицу prices обработанного файла из авито: 16-10-23 (без дублей).csv
2023-10-17 17:33:40,658 [INFO    ] данные avito загружены успешно
2023-10-17 17:33:41,179 [INFO    ] Новые данные загружены по файлам ['15-10-23 (без дублей).csv', '16-10-23 (без дублей).csv'] из авито и ['циан 15-10-23 (без дублей).csv', 'циан 16-10-23 (без дублей).csv'] из циана за 0:16:23.680231
2023-10-17 17:33:41,249 [INFO    ] HTTP Request: GET https://dadata.ru/api/v2/profile/balance "HTTP/1.1 200 OK"
2023-10-17 17:33:41,250 [INFO    ] сохранение лог-файла
