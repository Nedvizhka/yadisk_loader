2023-12-02 16:23:18,667 [INFO    ] Скрипт запущен: 2023-12-02 16:23:18.666910
2023-12-02 16:23:18,738 [INFO    ] Connected (version 2.0, client OpenSSH_7.4p1)
2023-12-02 16:23:18,799 [INFO    ] Authentication (publickey) failed.
2023-12-02 16:23:18,808 [INFO    ] Connected (version 2.0, client OpenSSH_7.4p1)
2023-12-02 16:23:18,808 [ERROR   ] Exception during reset or similar
Traceback (most recent call last):
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/sqlalchemy/pool/base.py", line 988, in _finalize_fairy
    fairy._reset(
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/sqlalchemy/pool/base.py", line 1437, in _reset
    pool._dialect.do_rollback(self)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 693, in do_rollback
    dbapi_connection.rollback()
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/connections.py", line 482, in rollback
    self._read_ok_packet()
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/connections.py", line 442, in _read_ok_packet
    pkt = self._read_packet()
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/connections.py", line 696, in _read_packet
    packet_header = self._read_bytes(4)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/connections.py", line 752, in _read_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2013, 'Lost connection to MySQL server during query')
2023-12-02 16:23:18,810 [ERROR   ] Exception during reset or similar
Traceback (most recent call last):
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/sqlalchemy/pool/base.py", line 988, in _finalize_fairy
    fairy._reset(
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/sqlalchemy/pool/base.py", line 1437, in _reset
    pool._dialect.do_rollback(self)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 693, in do_rollback
    dbapi_connection.rollback()
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/connections.py", line 482, in rollback
    self._read_ok_packet()
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/connections.py", line 442, in _read_ok_packet
    pkt = self._read_packet()
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/connections.py", line 696, in _read_packet
    packet_header = self._read_bytes(4)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/connections.py", line 752, in _read_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2013, 'Lost connection to MySQL server during query')
2023-12-02 16:23:18,882 [INFO    ] Authentication (password) successful!
2023-12-02 16:23:18,884 [INFO    ] connected to host 92.53.64.66 base preprod_nedvizhka_db
2023-12-02 16:23:19,075 [INFO    ] yandex token valid
2023-12-02 16:23:19,834 [INFO    ] Успешно загружено 0 файлов с личного диска: [] для avito
2023-12-02 16:23:20,005 [INFO    ] yandex token valid
2023-12-02 16:23:22,698 [INFO    ] Успешно загружено 1 файлов с личного диска: ['циан 01-12-23 (без дублей).csv'] для cian
2023-12-02 16:23:22,698 [INFO    ] ready to process files [], ['циан 01-12-23 (без дублей).csv']
2023-12-02 16:23:24,743 [INFO    ] обновлен status_new в таблице realty
2023-12-02 16:24:38,352 [INFO    ] обновлен status_new в таблице prices
2023-12-02 16:24:38,354 [INFO    ] обработка файла циан 01-12-23 (без дублей).csv для cian
2023-12-02 16:24:38,359 [ERROR   ] Traceback (most recent call last):
  File "/var/www/yadisk_loader/main_utils.py", line 971, in process_realty
    saved_file = pd.read_csv(saved_files[f_ind], delimiter=';', encoding='utf8')
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pandas/util/_decorators.py", line 211, in wrapper
    return func(*args, **kwargs)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pandas/util/_decorators.py", line 331, in wrapper
    return func(*args, **kwargs)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pandas/io/parsers/readers.py", line 950, in read_csv
    return _read(filepath_or_buffer, kwds)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pandas/io/parsers/readers.py", line 611, in _read
    return parser.read(nrows)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pandas/io/parsers/readers.py", line 1778, in read
    ) = self._engine.read(  # type: ignore[attr-defined]
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pandas/io/parsers/c_parser_wrapper.py", line 230, in read
    chunks = self._reader.read_low_memory(nrows)
  File "pandas/_libs/parsers.pyx", line 808, in pandas._libs.parsers.TextReader.read_low_memory
  File "pandas/_libs/parsers.pyx", line 866, in pandas._libs.parsers.TextReader._read_rows
  File "pandas/_libs/parsers.pyx", line 852, in pandas._libs.parsers.TextReader._tokenize_rows
  File "pandas/_libs/parsers.pyx", line 1973, in pandas._libs.parsers.raise_parser_error
pandas.errors.ParserError: Error tokenizing data. C error: Expected 6 fields in line 19, saw 7


2023-12-02 16:24:38,360 [ERROR   ] Файл циан 01-12-23 (без дублей).csv не удалось обнаружить для realty
2023-12-02 16:24:38,360 [ERROR   ] Ошибка при обработке файлов из CIAN циан 01-12-23 (без дублей).csv. Перезапуск скрипта...
2023-12-02 16:24:38,598 [ERROR   ] не удалось удалить таблицу: temp_realty_new (Traceback (most recent call last):
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/connections.py", line 549, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/connections.py", line 779, in _read_query_result
    result.read()
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/connections.py", line 1157, in read
    first_packet = self.connection._read_packet()
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/connections.py", line 729, in _read_packet
    packet.raise_for_error()
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.OperationalError: (1051, "Unknown table 'preprod_nedvizhka_db.temp_realty_new'")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/var/www/yadisk_loader/sql_config_utils.py", line 113, in drop_temp_table
    con_obj.execute(text(delete_table_query))
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/connections.py", line 549, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/connections.py", line 779, in _read_query_result
    result.read()
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/connections.py", line 1157, in read
    first_packet = self.connection._read_packet()
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/connections.py", line 729, in _read_packet
    packet.raise_for_error()
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (1051, "Unknown table 'preprod_nedvizhka_db.temp_realty_new'")
[SQL: DROP table temp_realty_new]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
)
2023-12-02 16:24:38,746 [ERROR   ] не удалось удалить таблицу: temp_jkh_houses (Traceback (most recent call last):
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/connections.py", line 549, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/connections.py", line 779, in _read_query_result
    result.read()
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/connections.py", line 1157, in read
    first_packet = self.connection._read_packet()
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/connections.py", line 729, in _read_packet
    packet.raise_for_error()
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.OperationalError: (1051, "Unknown table 'preprod_nedvizhka_db.temp_jkh_houses'")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/var/www/yadisk_loader/sql_config_utils.py", line 113, in drop_temp_table
    con_obj.execute(text(delete_table_query))
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/connections.py", line 549, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/connections.py", line 779, in _read_query_result
    result.read()
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/connections.py", line 1157, in read
    first_packet = self.connection._read_packet()
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/connections.py", line 729, in _read_packet
    packet.raise_for_error()
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (1051, "Unknown table 'preprod_nedvizhka_db.temp_jkh_houses'")
[SQL: DROP table temp_jkh_houses]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
)
2023-12-02 16:24:38,747 [ERROR   ] Ошибка при обработке файлов
2023-12-02 16:24:38,753 [INFO    ] сохранение лог-файла
