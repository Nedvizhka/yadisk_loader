2023-12-26 15:01:19,827 [INFO    ] Скрипт запущен: 2023-12-26 15:01:19.827281
2023-12-26 15:01:19,914 [INFO    ] Connected (version 2.0, client OpenSSH_7.4p1)
2023-12-26 15:01:19,985 [INFO    ] Authentication (publickey) failed.
2023-12-26 15:01:20,000 [INFO    ] Connected (version 2.0, client OpenSSH_7.4p1)
2023-12-26 15:01:20,087 [INFO    ] Authentication (password) successful!
2023-12-26 15:01:20,089 [INFO    ] connected to host 92.53.64.66 base preprod_nedvizhka_db
2023-12-26 15:01:20,255 [INFO    ] yandex token valid
2023-12-26 15:01:23,800 [INFO    ] Успешно загружено 1 файлов с личного диска: ['25-12-23 (без дублей).csv'] для avito
2023-12-26 15:01:23,956 [INFO    ] yandex token valid
2023-12-26 15:01:43,814 [INFO    ] Успешно загружено 10 файлов с личного диска: ['циан 16-12-23 (без дублей).csv', 'циан 17-12-23 (без дублей).csv', 'циан 18-12-23 (без дублей).csv', 'циан 19-12-23 (без дублей).csv', 'циан 20-12-23 (без дублей).csv', 'циан 21-12-23 (без дублей).csv', 'циан 22-12-23 (без дублей).csv', 'циан 23-12-23 (без дублей).csv', 'циан 24-12-23 (без дублей).csv', 'циан 25-12-23 (без дублей).csv'] для cian
2023-12-26 15:01:43,814 [INFO    ] ready to process files ['25-12-23 (без дублей).csv'], ['циан 16-12-23 (без дублей).csv', 'циан 17-12-23 (без дублей).csv', 'циан 18-12-23 (без дублей).csv', 'циан 19-12-23 (без дублей).csv', 'циан 20-12-23 (без дублей).csv', 'циан 21-12-23 (без дублей).csv', 'циан 22-12-23 (без дублей).csv', 'циан 23-12-23 (без дублей).csv', 'циан 24-12-23 (без дублей).csv', 'циан 25-12-23 (без дублей).csv']
2023-12-26 15:02:05,175 [INFO    ] обновлен status_new в таблице realty
2023-12-26 15:02:18,110 [INFO    ] обновлен status_new в таблице prices
2023-12-26 15:02:18,113 [INFO    ] обработка файла циан 16-12-23 (без дублей).csv для cian
2023-12-26 15:02:18,136 [ERROR   ] Traceback (most recent call last):
  File "/var/www/yadisk_loader/main_utils.py", line 972, in process_realty
    saved_file = pd.read_csv(saved_files[f_ind], delimiter=',', encoding='utf8')
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pandas/util/_decorators.py", line 211, in wrapper
    return func(*args, **kwargs)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pandas/util/_decorators.py", line 331, in wrapper
    return func(*args, **kwargs)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pandas/io/parsers/readers.py", line 950, in read_csv
    return _read(filepath_or_buffer, kwds)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pandas/io/parsers/readers.py", line 611, in _read
    return parser.read(nrows)
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pandas/io/parsers/readers.py", line 1778, in read
    ) = self._engine.read(  # type: ignore[attr-defined]
  File "/var/www/yadisk_loader/yadisk_venv/lib/python3.9/site-packages/pandas/io/parsers/c_parser_wrapper.py", line 230, in read
    chunks = self._reader.read_low_memory(nrows)
  File "pandas/_libs/parsers.pyx", line 808, in pandas._libs.parsers.TextReader.read_low_memory
  File "pandas/_libs/parsers.pyx", line 866, in pandas._libs.parsers.TextReader._read_rows
  File "pandas/_libs/parsers.pyx", line 852, in pandas._libs.parsers.TextReader._tokenize_rows
  File "pandas/_libs/parsers.pyx", line 1973, in pandas._libs.parsers.raise_parser_error
pandas.errors.ParserError: Error tokenizing data. C error: Expected 6 fields in line 164, saw 7


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/var/www/yadisk_loader/main_utils.py", line 976, in process_realty
    saved_file = pd.read_csv(f_name, delimiter=';', encoding='utf8')
NameError: name 'f_name' is not defined

2023-12-26 15:02:18,139 [ERROR   ] Файл циан 16-12-23 (без дублей).csv не удалось обнаружить для realty
2023-12-26 15:02:18,139 [ERROR   ] Ошибка при обработке файлов из CIAN циан 16-12-23 (без дублей).csv. Перезапуск скрипта...
2023-12-26 15:02:18,208 [INFO    ] обработка файла 25-12-23 (без дублей).csv для авито
2023-12-26 15:03:04,955 [INFO    ] Успешно обработан файл 25-12-23 (без дублей).csv для realty
2023-12-26 15:03:05,016 [INFO    ] Выгрузка в таблицу realty обработанного файла из авито: 25-12-23 (без дублей).csv
2023-12-26 15:03:05,271 [INFO    ] Временная таблица создана
2023-12-26 15:03:10,642 [INFO    ] Загрузка новых объявлений в таблицу
2023-12-26 15:03:10,825 [INFO    ] 175364 существующих и 1633 новых объявлений
2023-12-26 15:03:10,881 [INFO    ] temp таблица очищена, загружаются данные
2023-12-26 15:04:13,644 [INFO    ] обновлена таблица realty
2023-12-26 15:04:23,242 [INFO    ] обновлены районы в таблице realty
2023-12-26 15:04:36,444 [INFO    ] Обновление существующих данных realty завершено
2023-12-26 15:05:10,085 [INFO    ] из новых объяв найдено по адресу 503, запрос в ddt для 684 уник. адресов из 1130
2023-12-26 15:05:10,085 [INFO    ] обновление районов для найденных в realty по адресу новых объявлений:
2023-12-26 15:05:10,485 [INFO    ] обнаружено 263 районов для 430 новых объявлений, найденных по адресу из 503
2023-12-26 15:05:10,505 [INFO    ] 173 районов осталось незаполнено
2023-12-26 15:05:10,506 [INFO    ] переход к обновлению оставшихся (не найденных по адресу) 1130 новых объявлений (684 адресов) для avito
2023-12-26 15:05:10,526 [INFO    ] загрузка данных dadata из /var/www/yadisk_loader/saved_data_csv/avito_dadata_request.csv
2023-12-26 15:05:11,796 [INFO    ] удалось загрузить исторические данные dadata
2023-12-26 15:05:13,808 [INFO    ] количество запросов к dadata составит: 684
2023-12-26 15:05:13,814 [INFO    ] 0%|          | 0/226 [00:00<?, ?it/s]
2023-12-26 15:05:15,882 [INFO    ] 684it [00:02, 330.76it/s]
2023-12-26 15:05:15,882 [INFO    ] 
2023-12-26 15:05:15,882 [INFO    ] dadata con closed succesfully
2023-12-26 15:05:15,883 [INFO    ] обращение к DDT по 654/684 адресам из avito заняло 0:00:05.377178
2023-12-26 15:05:15,894 [INFO    ] обращение к DDT выполнено для 873/1130 новых объявлений, найден fias для 482
2023-12-26 15:06:22,130 [INFO    ] уникальных троек по h_fias_id, ad_id, d_id, в таблице с районами и houses_jkh_ddt/id: 873
2023-12-26 15:06:22,135 [INFO    ] выгрузка данных в таблицу realty
2023-12-26 15:06:22,519 [INFO    ] Добавлено районов к объявлениям realty: 127 - было 0 стало 127
2023-12-26 15:06:22,519 [INFO    ] Есть несовпадения районов c jkh, обновление районов в jkh для 0 записей
2023-12-26 15:06:28,900 [INFO    ] Временная таблица temp_jkh_houses создана
2023-12-26 15:06:32,192 [INFO    ] Обновление данных jkh_houses завершено
2023-12-26 15:06:33,165 [INFO    ] все новые объявления добавлены
2023-12-26 15:06:35,171 [INFO    ] Успешно обработан файл 25-12-23 (без дублей).csv для prices
2023-12-26 15:06:35,171 [INFO    ] Выгрузка в таблицу prices обработанного файла из авито: 25-12-23 (без дублей).csv
2023-12-26 15:06:52,968 [INFO    ] данные avito загружены успешно
2023-12-26 15:06:53,277 [INFO    ] Новые данные загружены по файлам ['25-12-23 (без дублей).csv'] из авито и ['циан 16-12-23 (без дублей).csv', 'циан 17-12-23 (без дублей).csv', 'циан 18-12-23 (без дублей).csv', 'циан 19-12-23 (без дублей).csv', 'циан 20-12-23 (без дублей).csv', 'циан 21-12-23 (без дублей).csv', 'циан 22-12-23 (без дублей).csv', 'циан 23-12-23 (без дублей).csv', 'циан 24-12-23 (без дублей).csv', 'циан 25-12-23 (без дублей).csv'] из циана за 0:05:33.450229
2023-12-26 15:06:53,388 [INFO    ] HTTP Request: GET https://dadata.ru/api/v2/profile/balance "HTTP/1.1 200 OK"
2023-12-26 15:06:53,391 [INFO    ] сохранение лог-файла
