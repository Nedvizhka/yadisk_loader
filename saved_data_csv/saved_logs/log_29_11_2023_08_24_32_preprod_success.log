2023-11-29 08:01:31,625 [INFO    ] Скрипт запущен: 2023-11-29 08:01:31.625659
2023-11-29 08:01:31,720 [INFO    ] Connected (version 2.0, client OpenSSH_7.4p1)
2023-11-29 08:01:31,853 [INFO    ] Authentication (publickey) failed.
2023-11-29 08:01:31,867 [INFO    ] Connected (version 2.0, client OpenSSH_7.4p1)
2023-11-29 08:01:31,926 [INFO    ] Authentication (password) successful!
2023-11-29 08:01:31,966 [INFO    ] connected to host 92.53.64.66 base preprod_nedvizhka_db
2023-11-29 08:01:32,166 [INFO    ] yandex token valid
2023-11-29 08:01:34,843 [INFO    ] Успешно загружено 1 файлов с личного диска: ['28-11-23 (без дублей).csv'] для avito
2023-11-29 08:01:34,989 [INFO    ] yandex token valid
2023-11-29 08:01:37,554 [INFO    ] Успешно загружено 1 файлов с личного диска: ['циан 28-11-23 (без дублей).csv'] для cian
2023-11-29 08:01:37,554 [INFO    ] ready to process files ['28-11-23 (без дублей).csv'], ['циан 28-11-23 (без дублей).csv']
2023-11-29 08:02:04,575 [INFO    ] обновлен status_new в таблице realty
2023-11-29 08:07:10,266 [INFO    ] обновлен status_new в таблице prices
2023-11-29 08:07:10,271 [INFO    ] обработка файла циан 28-11-23 (без дублей).csv для cian
2023-11-29 08:07:11,883 [INFO    ] обработка district_id:
2023-11-29 08:07:11,894 [INFO    ] districts_update:   0%|          | 0/119911 [00:00<?, ?it/s]
2023-11-29 08:07:26,895 [INFO    ] districts_update:  11%|#1        | 13667/119911 [00:15<01:56, 911.09it/s]
2023-11-29 08:07:41,895 [INFO    ] districts_update:  23%|##3       | 27908/119911 [00:30<01:38, 933.62it/s]
2023-11-29 08:07:51,903 [INFO    ] districts_update:  32%|###2      | 38751/119911 [00:40<01:26, 933.62it/s]
2023-11-29 08:07:56,895 [INFO    ] districts_update:  37%|###6      | 43783/119911 [00:45<01:16, 990.55it/s]
2023-11-29 08:08:11,912 [INFO    ] districts_update:  49%|####8     | 58342/119911 [01:00<01:02, 990.55it/s]
2023-11-29 08:08:11,912 [INFO    ] districts_update:  49%|####8     | 58343/119911 [01:00<01:02, 982.26it/s]
2023-11-29 08:08:21,913 [INFO    ] districts_update:  57%|#####6    | 67959/119911 [01:10<00:52, 982.26it/s]
2023-11-29 08:08:26,912 [INFO    ] districts_update:  61%|######    | 72986/119911 [01:15<00:47, 980.08it/s]
2023-11-29 08:08:41,963 [INFO    ] districts_update:  73%|#######2  | 86991/119911 [01:30<00:33, 980.08it/s]
2023-11-29 08:08:41,963 [INFO    ] districts_update:  73%|#######2  | 86992/119911 [01:30<00:34, 963.21it/s]
2023-11-29 08:08:51,965 [INFO    ] districts_update:  81%|########1 | 97359/119911 [01:40<00:23, 963.21it/s]
2023-11-29 08:08:56,963 [INFO    ] districts_update:  85%|########5 | 102489/119911 [01:45<00:17, 986.05it/s]
2023-11-29 08:09:01,919 [INFO    ] добавлен новый район "Авиатор" в districts функцией district_from_rn_mkrn
2023-11-29 08:09:11,967 [INFO    ] districts_update:  98%|#########7| 116960/119911 [02:00<00:02, 986.05it/s]
2023-11-29 08:09:11,967 [INFO    ] districts_update:  98%|#########7| 116961/119911 [02:00<00:03, 979.20it/s]
2023-11-29 08:09:15,132 [INFO    ] districts_update: 100%|##########| 119911/119911 [02:03<00:00, 973.00it/s]
2023-11-29 08:09:15,133 [INFO    ] 
2023-11-29 08:09:15,145 [INFO    ] district add from realty
2023-11-29 08:09:19,613 [INFO    ] Успешно обработан файл циан 28-11-23 (без дублей).csv для realty
2023-11-29 08:09:19,621 [INFO    ] Выгрузка в таблицу realty обработанного файла из cian: циан 28-11-23 (без дублей).csv
2023-11-29 08:09:19,808 [INFO    ] Временная таблица очищена
2023-11-29 08:09:44,484 [INFO    ] Загрузка новых объявлений в таблицу
2023-11-29 08:09:44,741 [INFO    ] 107304 существующих и 12607 новых объявлений
2023-11-29 08:09:44,789 [INFO    ] temp таблица очищена, загружаются данные
2023-11-29 08:11:28,896 [INFO    ] обновлена таблица realty
2023-11-29 08:12:33,046 [INFO    ] обновлены районы в таблице realty
2023-11-29 08:12:40,056 [INFO    ] Обновление существующих данных realty завершено
2023-11-29 08:13:14,929 [INFO    ] из новых объяв найдено по адресу 5418, запрос в ddt для 3116 уник. адресов из 7189
2023-11-29 08:13:14,932 [INFO    ] обновление районов для найденных в realty по адресу новых объявлений:
2023-11-29 08:13:15,062 [INFO    ] обнаружено 166 районов для 216 новых объявлений, найденных по адресу из 415
2023-11-29 08:13:15,075 [INFO    ] 127 районов осталось незаполнено
2023-11-29 08:13:15,078 [INFO    ] переход к обновлению оставшихся (не найденных по адресу) 7189 новых объявлений (3116 адресов) для cian
2023-11-29 08:13:15,109 [INFO    ] загрузка данных dadata из /var/www/yadisk_loader/saved_data_csv/cian_dadata_request.csv
2023-11-29 08:13:16,088 [INFO    ] удалось загрузить исторические данные dadata
2023-11-29 08:13:18,110 [INFO    ] количество запросов к dadata составит: 3116
2023-11-29 08:13:18,116 [INFO    ] 0%|          | 0/407 [00:00<?, ?it/s]
2023-11-29 08:13:27,235 [INFO    ] 3116it [00:09, 341.70it/s]
2023-11-29 08:13:27,235 [INFO    ] 
2023-11-29 08:13:27,236 [INFO    ] dadata con closed succesfully
2023-11-29 08:13:27,238 [INFO    ] обращение к DDT по 2720/3116 адресам из cian заняло 0:00:12.159809
2023-11-29 08:13:27,268 [INFO    ] обращение к DDT выполнено для 4939/7189 новых объявлений, найден fias для 3979
2023-11-29 08:15:14,841 [INFO    ] уникальных троек по h_fias_id, ad_id, d_id, в таблице с районами и houses_jkh_ddt/id: 4939
2023-11-29 08:15:14,843 [INFO    ] выгрузка данных в таблицу realty
2023-11-29 08:15:17,247 [INFO    ] Добавлено районов к объявлениям realty: 9 - было 5525 стало 5534
2023-11-29 08:15:17,247 [INFO    ] Есть несовпадения районов c jkh, обновление районов в jkh для 66 записей
2023-11-29 08:15:20,392 [INFO    ] Временная таблица temp_jkh_houses очищена
2023-11-29 08:15:23,714 [INFO    ] Обновление данных jkh_houses завершено
2023-11-29 08:15:28,248 [INFO    ] все новые объявления добавлены
2023-11-29 08:15:29,830 [INFO    ] Успешно обработан файл циан 28-11-23 (без дублей).csv для prices
2023-11-29 08:15:29,830 [INFO    ] Выгрузка в таблицу prices обработанного файла из cian: циан 28-11-23 (без дублей).csv
2023-11-29 08:15:46,328 [INFO    ] данные cian загружены успешно
2023-11-29 08:15:46,416 [INFO    ] обработка файла 28-11-23 (без дублей).csv для авито
2023-11-29 08:16:36,073 [INFO    ] Успешно обработан файл 28-11-23 (без дублей).csv для realty
2023-11-29 08:16:36,127 [INFO    ] Выгрузка в таблицу realty обработанного файла из авито: 28-11-23 (без дублей).csv
2023-11-29 08:16:36,275 [INFO    ] Временная таблица очищена
2023-11-29 08:16:43,865 [INFO    ] Загрузка новых объявлений в таблицу
2023-11-29 08:16:44,048 [INFO    ] 156418 существующих и 23250 новых объявлений
2023-11-29 08:16:44,095 [INFO    ] temp таблица очищена, загружаются данные
2023-11-29 08:19:17,707 [INFO    ] обновлена таблица realty
2023-11-29 08:19:19,845 [INFO    ] обновлены районы в таблице realty
2023-11-29 08:19:46,957 [INFO    ] Обновление существующих данных realty завершено
2023-11-29 08:20:20,385 [INFO    ] из новых объяв найдено по адресу 6001, запрос в ddt для 3680 уник. адресов из 17249
2023-11-29 08:20:20,387 [INFO    ] обновление районов для найденных в realty по адресу новых объявлений:
2023-11-29 08:20:22,239 [INFO    ] обнаружено 1991 районов для 3297 новых объявлений, найденных по адресу из 6001
2023-11-29 08:20:22,255 [INFO    ] 1319 районов осталось незаполнено
2023-11-29 08:20:22,260 [INFO    ] переход к обновлению оставшихся (не найденных по адресу) 17249 новых объявлений (3680 адресов) для avito
2023-11-29 08:20:22,286 [INFO    ] загрузка данных dadata из /var/www/yadisk_loader/saved_data_csv/avito_dadata_request.csv
2023-11-29 08:20:23,666 [INFO    ] удалось загрузить исторические данные dadata
2023-11-29 08:20:25,683 [INFO    ] количество запросов к dadata составит: 3680
2023-11-29 08:20:25,686 [INFO    ] 0%|          | 0/328 [00:00<?, ?it/s]
2023-11-29 08:20:35,689 [INFO    ] 2776it [00:10, 277.52it/s]
2023-11-29 08:20:39,152 [INFO    ] 3680it [00:13, 273.28it/s]
2023-11-29 08:20:39,152 [INFO    ] 
2023-11-29 08:20:39,152 [INFO    ] dadata con closed succesfully
2023-11-29 08:20:39,155 [INFO    ] обращение к DDT по 3463/3680 адресам из avito заняло 0:00:16.895421
2023-11-29 08:20:39,216 [INFO    ] обращение к DDT выполнено для 15586/17249 новых объявлений, найден fias для 7646
2023-11-29 08:23:34,384 [INFO    ] уникальных троек по h_fias_id, ad_id, d_id, в таблице с районами и houses_jkh_ddt/id: 15586
2023-11-29 08:23:34,424 [INFO    ] выгрузка данных в таблицу realty
2023-11-29 08:23:39,946 [INFO    ] Добавлено районов к объявлениям realty: 1067 - было 0 стало 1067
2023-11-29 08:23:39,946 [INFO    ] Есть несовпадения районов c jkh, обновление районов в jkh для 0 записей
2023-11-29 08:23:43,069 [INFO    ] Временная таблица temp_jkh_houses очищена
2023-11-29 08:23:46,205 [INFO    ] Обновление данных jkh_houses завершено
2023-11-29 08:23:54,952 [INFO    ] все новые объявления добавлены
2023-11-29 08:23:58,042 [INFO    ] Успешно обработан файл 28-11-23 (без дублей).csv для prices
2023-11-29 08:23:58,042 [INFO    ] Выгрузка в таблицу prices обработанного файла из авито: 28-11-23 (без дублей).csv
2023-11-29 08:24:32,016 [INFO    ] данные avito загружены успешно
2023-11-29 08:24:32,690 [INFO    ] Новые данные загружены по файлам ['28-11-23 (без дублей).csv'] из авито и ['циан 28-11-23 (без дублей).csv'] из циана за 0:23:01.064841
2023-11-29 08:24:32,866 [INFO    ] HTTP Request: GET https://dadata.ru/api/v2/profile/balance "HTTP/1.1 200 OK"
2023-11-29 08:24:32,869 [INFO    ] сохранение лог-файла
